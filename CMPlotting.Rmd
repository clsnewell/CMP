---
title: "CMPlotting"
author: "Caroline Newell"
date: "4/3/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---
##Load packages
```{r}
library(readxl)
library(tidyverse)
library(lubridate)
```

# Plot Fish Data

##Liver
```{r}
FishIsotopeAndMetaData_040322 <- read_excel("Data/FishIsotopeAndMetaData_040322.xlsx")

FishLiverDataSummarized_040422 <- read_excel("Data/FishLiverDataSummarized_040422.xlsx")

FishLiverDataSummarized_040422$`D13CVPDB(permill)`<- as.numeric(FishLiverDataSummarized_040422$`D13CVPDB(permill)`)

FishLiverDataSummarized_040422$`D15NAir(permill)`<- as.numeric(FishLiverDataSummarized_040422$`D15NAir(permill)`)

FishLiverDataSummarized_040422$`D34SVCDT(permill)`<- as.numeric(FishLiverDataSummarized_040422$`D34SVCDT(permill)`)

FishLiverDataSummarized_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~Species) + labs(title= "Fish Liver Data from all Seasons")


FishLiverDataSummarized_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point()

unique(FishLiverDataSummarized_040422$Species)

FishLiverDataSummarized_040422 %>% filter(Season == "Summer") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Liver Data from Summer")

FishLiverDataSummarized_040422 %>% filter(Season == "Fall") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Liver Data from Fall")
```

## Muscle
```{r}
FishIsotopeAndMetaData_040322 <- read_excel("Data/FishIsotopeAndMetaData_040322.xlsx")

FishMuscleDataSummarized_040422 <- read_excel("Data/FishMuscleDataSummarized_040422.xlsx")

FishMuscleDataSummarized_040422$`D13CVPDB(permill)`<- as.numeric(FishMuscleDataSummarized_040422$`D13CVPDB(permill)`)

FishMuscleDataSummarized_040422$`D15NAir(permill)`<- as.numeric(FishMuscleDataSummarized_040422$`D15NAir(permill)`)

FishMuscleDataSummarized_040422$`D34SVCDT(permill)`<- as.numeric(FishMuscleDataSummarized_040422$`D34SVCDT(permill)`)

FishMuscleDataSummarized_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~Species) + labs(title= "Fish Muscle Data from all Seasons")

```

Teejay asks: "Can we organize the fishes by community type rather than alphabetically (e.g., TFS, ASH, ISS, SB all together)?  And can we split 'em by seasons - lump June/July fish, then Sept fish?  At least for YOY SB and SCP."

```{r}
facet_wrap(~factor(Season, levels = c("Summer", "Fall")))

unique(FishMuscleDataSummarized_040422$Species)

FishMuscleDataSummarized_040422 %>% filter(Season == "Summer") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Muscle Data from Summer")

FishMuscleDataSummarized_040422 %>% filter(Season == "Fall") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Muscle Data from Fall")
```

# Plot plant data
```{r}
PlantIsotopeAndMetaData_040422 <- read_excel("Data/PlantIsotopeAndMetaData_040422.xlsx")

PlantIsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(PlantIsotopeAndMetaData_040422$`D13CVPDB(permill)`)

PlantIsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(PlantIsotopeAndMetaData_040422$`D15NAir(permill)`)

PlantIsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(PlantIsotopeAndMetaData_040422$`D34SVCDT(permill)`)

glimpse(PlantIsotopeAndMetaData_040422)

PlantIsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~SpeciesCode) + labs(title = "Plant Data all Seasons")

PlantIsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~factor(SpeciesCode, levels = c("DET", "SAGO", "MYSP", "FILA", "PHAU", "TYAN", "SCAC", "SCAM", "SCCA", "LEMNA", "AZFI", "ARSU", "SAPA", "CASE", "JACA", "LELA", "ROCA", "LAJE", "JUBA", "LOCO", "PLOD"))) + labs(title = "Plant Species Data all Seasons")

PlantIsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~Class) + labs(title = "Plant Data all Seasons")

```

# Plot Big Invert Data
```{r}
LargeMacroinvert_IsotopeAndMetaData_040422 <- read_excel("Data/LargeMacroinvert_IsotopeAndMetaData_040422.xlsx")

LargeMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~Species) + labs(title = "Large Invert Data all Seasons")

```

# Plot Small Inverts
```{r}
SmallMacroinvert_IsotopeAndMetaData_040422 <- read_excel("Data/SmallMacroinvert_IsotopeAndMetaData_040422.xlsx")

SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~Species) + labs(title = "Small Invert Data all Seasons")
```

# Plot Zoop data
```{r}
ZoopIsotopeAndMetaData_040722 <- read_excel("Data/ZoopIsotopeAndMetaData_040722_edited.xlsx")

ZoopIsotopeAndMetaData_040722 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~ZoopSpecies) + labs(title = "Zoop Data all Seasons")
```

#Plot POM data
```{r}
POM_BA_IsotopeAndMetaData_040522 <- read_excel("Data/POM_BA_IsotopeAndMetaData_040522.xlsx")
View(POM_BA_IsotopeAndMetaData_040522)
glimpse(POM_BA_IsotopeAndMetaData_040522)

POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`)

#Remove rows with uncertain sites.
POM_BA_IsotopeAndMetaData<- POM_BA_IsotopeAndMetaData_040522[!(POM_BA_IsotopeAndMetaData_040522$Site == "SD or SM" | POM_BA_IsotopeAndMetaData_040522$Site == "NA"),]

View(POM_BA_IsotopeAndMetaData)

POM_BA_IsotopeAndMetaData %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~`Sample Type`) + labs(title = "POM and BA Data all Seasons")

```


# 1. For organisms captured in both summer and fall, a plot of all data, differentiated by season by color ( if you want to include sites use symbols). Include a mean with SDs overlaying the data points. Main sp for which we have data: SB, ST, TP, SCP, SG, YFG

Which species were captured in both summer and fall?
## Fish Livers Caught Both Seasons
```{r}
#I'm going to filter the data for species that were captured in both summer and fall.
#Use all Zoops, POM, BA. BUT I need to determine which inverts, fish, and plants were sampled both seasons...
FishMuscleData_040722 <- read_excel("Data/FishMuscleData_040722.xlsx")

FishLiverData_040722 <- read_excel("Data/FishLiverData_040722.xlsx")

FishLiversSummer<-subset(FishLiverData_040722, Season == "Summer")
FishLiversFall<-subset(FishLiverData_040722, Season == "Fall")

FishLiversBothSeasons<- inner_join(FishLiversFall, FishLiversSummer, by= "Species")

unique(FishLiversBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons: "SB"  "ST"  "YFG" "SG"  "SCP" "SKG" "TP"  "BC"
#Now filter out just these fish species from liver data

unique(FishLiverData_040722$Species)

FishLiverData_SpeciesBothSeasons<- FishLiverData_040722 %>% filter(Species %in% c("SB",  "ST",  "YFG", "SG",  "SCP", "SKG", "TP"))
#Okay, now I want to get the average and sd of C and N values for these fish livers.
View(FishLiverData_SpeciesBothSeasons)

FishLivers_BothSeasons_MeansSd<-FishLiverData_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season, `Age Class`) %>% 
  summarize(n=n(),
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)))

View(FishLivers_BothSeasons_MeansSd)

#plot!
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")

Liver_Seasons<- FishLivers_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species), hjust=1.25, vjust = 1) +
  labs(title = "Liver results from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Liver_Seasons
```

## Fish Muscles
```{r}
#Now do the same for muscle.
FishMuscle_Summer<-subset(FishMuscleData_040722, Season == "Summer")
FishMusclesFall<-subset(FishMuscleData_040722, Season == "Fall")

FishMusclessBothSeasons<- inner_join(FishMuscle_Summer, FishMusclesFall, by= "Species")

unique(FishMusclessBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons: "SCP" "ST"  "TP"  "SB"  "YFG" "SKG" "SG"

#Now filter out just these fish species from muscle data

unique(FishMuscleData_040722$Species)

FishMuscleData_SpeciesBothSeasons<- FishMuscleData_040722 %>% filter(Species %in% c("SCP", "ST",  "TP",  "SB",  "YFG", "SKG", "SG"))

#Okay, now I want to get the average and sd of C and N values for these fish livers.
View(FishMuscleData_SpeciesBothSeasons)

FishMuscleData_SpeciesBothSeasons$`D13CVPDB(permill)`<- as.numeric(FishMuscleData_SpeciesBothSeasons$`D13CVPDB(permill)`)

FishMuscleData_SpeciesBothSeasons$`D15NAir(permill)`<- as.numeric(FishMuscleData_SpeciesBothSeasons$`D15NAir(permill)`)

FishMuscleData_SpeciesBothSeasons$`D34SVCDT(permill)`<- as.numeric(FishMuscleData_SpeciesBothSeasons$`D34SVCDT(permill)`)
  
FishMuscles_BothSeasons_MeansSd<-FishMuscleData_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season, `Age Class`) %>% 
  summarize(n=n(),
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)))

View(FishMuscles_BothSeasons_MeansSd)

Muscle_Seasons<- FishMuscles_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species), hjust=1.25, vjust = 1) +
  labs(title = "Muscle results from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Muscle_Seasons
```


## Big Inverts 
```{r}
#Went through and manually deleted all the columns for rows which had incorrect readings due to combustion column failure. 

LargeMacroinvert_IsotopeAndMetaData_040822 <- read_excel("Data/LargeMacroinvert_IsotopeAndMetaData_040822_Edited.xlsx")

LargeMacroinvert_IsotopeAndMetaData_040822$`D13CVPDB(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D13CVPDB(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040822$`D15NAir(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D15NAir(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040822$`D34SVCDT(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D34SVCDT(permill)`)

View(LargeMacroinvert_IsotopeAndMetaData_040822)
#Introduce Season column
LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date<-mdy(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date)

str(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date)

LargeMacroinvert_IsotopeAndMetaData_040822$Month<- format(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date, format = "%m")
unique(LargeMacroinvert_IsotopeAndMetaData_040822$Month)

LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "06"]<-"Summer"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "07"]<-"Summer"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "08"]<-"Fall"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "09"]<-"Fall"
View(LargeMacroinvert_IsotopeAndMetaData_040822)


BigInvertsSummer<-subset(LargeMacroinvert_IsotopeAndMetaData_040822, Season == "Summer")
BigInvertsFall<-subset(LargeMacroinvert_IsotopeAndMetaData_040822, Season == "Fall")

BigInvertsBothSeasons<- inner_join(BigInvertsFall, BigInvertsSummer, by= "Species")

unique(BigInvertsBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons: "Corbicula" "Exopalaemon"       "Harris mud crab"    "Maeotias" "Red swamp crayfish"
#Now filter out just these  species from big invert data

unique(LargeMacroinvert_IsotopeAndMetaData_040822$Species)
#Looks like we already have all the species. cool.

#Okay, now I want to get the average and sd of C and N values for these inverts.
View(LargeMacroinvert_IsotopeAndMetaData_040822)

BigInverts_BothSeasons_MeansSd<-LargeMacroinvert_IsotopeAndMetaData_040822%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)))

View(BigInverts_BothSeasons_MeansSd)

#plot!
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")

BigInverts_Seasons<- BigInverts_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species), hjust=1.25, vjust = 1) +
  labs(title = "Big Inverts from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
BigInverts_Seasons
```

## Small Inverts 
```{r}
SmallMacroinvert_IsotopeAndMetaData_040422 <- read_excel("Data/SmallMacroinvert_IsotopeAndMetaData_040422.xlsx")

SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`)

View(SmallMacroinvert_IsotopeAndMetaData_040422)

SmallInvertsSummer<-subset(SmallMacroinvert_IsotopeAndMetaData_040422, Season == "Summer")
unique(SmallInvertsSummer$Species)

SmallInvertsFall<-subset(SmallMacroinvert_IsotopeAndMetaData_040422, Season == "Fall")
unique(SmallInvertsFall$Species)


SmallInvertsBothSeasons<- inner_join(SmallInvertsFall, SmallInvertsSummer, by= "Species")

unique(SmallInvertsBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons:[1] "Americorophium spinicorne", "Crab Zoea", "Eogammarus confervicolus", "Gammarus daiberi", "Gnorimosphaeroma insulare"
#Now filter out just these  species from big invert data
View(SmallInvertsBothSeasons)


SmallInverts_SpeciesBothSeasons<- SmallMacroinvert_IsotopeAndMetaData_040422 %>% filter(Species %in% c("Americorophium spinicorne", "Crab Zoea", "Eogammarus confervicolus", "Gammarus daiberi", "Gnorimosphaeroma insulare"))

#Okay, now I want to get the average and sd of C and N values for these inverts.
View(SmallInverts_SpeciesBothSeasons)

SmallInverts_BothSeasons_MeansSd<-SmallInverts_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)))

View(SmallInverts_BothSeasons_MeansSd)

#plot!
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")

SmallInverts_Seasons<- SmallInverts_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species)) +
  labs(title = "Small Inverts from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
SmallInverts_Seasons
```


## Plants
```{r}
PlantIsotopeAndMetaData_040822 <- read_excel("Data/PlantIsotopeAndMetaData_040822.xlsx")
View(PlantIsotopeAndMetaData_040822)
Plants_Summer<-subset(PlantIsotopeAndMetaData_040822, Season == "Summer")
PlantsFall<-subset(PlantIsotopeAndMetaData_040822, Season == "Fall")

PlantsBothSeasons<- inner_join(Plants_Summer, PlantsFall, by= "Species")

unique(PlantsBothSeasons$Species)
#Okay, if I did this right, these are the species we sampled both seasons: "Sarcocornia/Salicornia pacifica", "Schoenoplectus acutusa", "Typha angustifolia", "Rosa californica", "Calystegia sepium", "Phragmites australis", "SAGO", "Myriophyllum spicatum", "Lemna sp", "Filamentous algae", "Lathyrus jepsonii jepsonii", "Schoenoplectus americanus", "Det"

#Now filter out just these  species 

unique(PlantIsotopeAndMetaData_040822$Species)

Plants_SpeciesBothSeasons<- PlantIsotopeAndMetaData_040822 %>% filter(Species %in% c("Sarcocornia/Salicornia pacifica", "Schoenoplectus acutusa", "Typha angustifolia", "Rosa californica", "Calystegia sepium", "Phragmites australis", "SAGO", "Myriophyllum spicatum", "Lemna sp", "Filamentous algae", "Lathyrus jepsonii jepsonii", "Schoenoplectus americanus", "Det"))

#Okay, now I want to get the average and sd of C and N values for these fish livers.
View(Plants_SpeciesBothSeasons)

Plants_SpeciesBothSeasons$`D13CVPDB(permill)`<- as.numeric(Plants_SpeciesBothSeasons$`D13CVPDB(permill)`)

Plants_SpeciesBothSeasons$`D15NAir(permill)`<- as.numeric(Plants_SpeciesBothSeasons$`D15NAir(permill)`)

Plants_SpeciesBothSeasons$`D34SVCDT(permill)`<- as.numeric(Plants_SpeciesBothSeasons$`D34SVCDT(permill)`)
  
Plants_BothSeasons_MeansSd<-Plants_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)))

View(Plants_BothSeasons_MeansSd)
#Remove SAGO with NA site info.
Plants_BothSeasons_MeanSd<-Plants_BothSeasons_MeansSd[!(Plants_BothSeasons_MeansSd$Season=="NA"),]
unique(Plants_BothSeasons_MeanSd$Season)

Plants_Seasons<- Plants_BothSeasons_MeanSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species)) +
  labs(title = "Plants from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Plants_Seasons
```
## POM/BA
```{r}
POM_BA_IsotopeAndMetaData_040522 <- read_excel("Data/POM_BA_IsotopeAndMetaData_040522.xlsx")
View(POM_BA_IsotopeAndMetaData_040522)
str(POM_BA_IsotopeAndMetaData_040522$Date)
#Introduce Season column
POM_BA_IsotopeAndMetaData_040522$Month<- format(POM_BA_IsotopeAndMetaData_040522$Date, format = "%m")
unique(POM_BA_IsotopeAndMetaData_040522$Month)

POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "06"]<-"Summer"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "07"]<-"Summer"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "08"]<-"Fall"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "09"]<-"Fall"
View(POM_BA_IsotopeAndMetaData_040522)

#Okay, now I want to get the average and sd of C and N values for POM and BA by site and season.

POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`)
  
POMBA_BothSeasons_MeansSd<-POM_BA_IsotopeAndMetaData_040522%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)))
#Remove Sites NA, SD or SM
unique(POMBA_BothSeasons_MeansSd$Site)
POMBA_BothSeasons_MeanSd<-POMBA_BothSeasons_MeansSd[!(POMBA_BothSeasons_MeansSd$Site=="NA" | POMBA_BothSeasons_MeansSd$Site=="SD or SM"),]
unique(POMBA_BothSeasons_MeanSd$Site)

POMBA_Seasons<- POMBA_BothSeasons_MeanSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species)) +
  labs(title = "POM and BA from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
POMBA_Seasons
```
## Zoops
```{r}
ZoopIsotopeAndMetaData_040722_edited <- read_excel("Data/ZoopIsotopeAndMetaData_040722_edited.xlsx")
ZoopIsotopeAndMetaData_040722_edited$Species<-ZoopIsotopeAndMetaData_040722_edited$ZoopSpecies
Zoops_Summer<-subset(ZoopIsotopeAndMetaData_040722_edited, Season == "Summer")
ZoopsFall<-subset(ZoopIsotopeAndMetaData_040722_edited, Season == "Fall")

ZoopsBothSeasons<- inner_join(Zoops_Summer, ZoopsFall, by= "Species")

unique(ZoopsBothSeasons$Species)
#Okay, if I did this right, these are the species we sampled both seasons: ">500 um",     "200-500 um",  "A. sinensis", "P. forbesi", "100-500 um" 

#Now filter out just these  species 

unique(ZoopIsotopeAndMetaData_040722_edited$Species)

Zoops_SpeciesBothSeasons<- ZoopIsotopeAndMetaData_040722_edited %>% filter(Species %in% c( ">500 um", "200-500 um", "A. sinensis", "P. forbesi", "100-500 um"))

#Okay, now I want to get the average and sd of C and N values for these fish livers.
View(Zoops_SpeciesBothSeasons)

Zoops_SpeciesBothSeasons$`D13CVPDB(permill)`<- as.numeric(Zoops_SpeciesBothSeasons$`D13CVPDB(permill)`)

Zoops_SpeciesBothSeasons$`D15NAir(permill)`<- as.numeric(Zoops_SpeciesBothSeasons$`D15NAir(permill)`)

Zoops_SpeciesBothSeasons$`D34SVCDT(permill)`<- as.numeric(Zoops_SpeciesBothSeasons$`D34SVCDT(permill)`)
  
Zoops_BothSeasons_MeansSd<-Zoops_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)))

View(Zoops_BothSeasons_MeansSd)

Zoops_Seasons<- Zoops_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species)) +
  labs(title = "Zoops from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Zoops_Seasons
```
## MEGA PLOT
```{r}
#Bind rows
AvgData_BothSeasons_Livers<-rbind(Zoops_BothSeasons_MeansSd, POMBA_BothSeasons_MeanSd, Plants_BothSeasons_MeanSd, SmallInverts_BothSeasons_MeansSd, BigInverts_BothSeasons_MeansSd, FishLivers_BothSeasons_MeansSd)
#Need to rename SB site to FM
AvgData_BothSeasons_Livers$Site[AvgData_BothSeasons_Livers$Site == "SB"] <-"FM"

Avg_Seasons_Livers<- AvgData_BothSeasons_Livers %>% ggplot(aes(D13C_mean, D15N_mean, color= Season)) + 
  geom_point(aes(color = Season, shape = Site)) + 
  geom_text(aes(label=Species)) +
  labs(title = "All from Summer and Fall - Fish livers") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) #+ 
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Avg_Seasons_Livers

AvgData_BothSeasons_Muscles<-rbind(Zoops_BothSeasons_MeansSd, POMBA_BothSeasons_MeanSd, Plants_BothSeasons_MeanSd, SmallInverts_BothSeasons_MeansSd, BigInverts_BothSeasons_MeansSd, FishMuscles_BothSeasons_MeansSd)

Avg_Seasons_Muscles<- AvgData_BothSeasons_Muscles %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  geom_text(aes(label=Species)) +
  labs(title = "All from Summer and Fall - fish muscles") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Avg_Seasons_Muscles


```
2. For organisms represented across most sloughs, a plot of all data differentiated by slough (aggregating seasons). Include a mean with SDS overlaying. Same species.

3. For the lower trophic level stuff, it would be good to roughly visualize approximate overlap among groups, via ordination or just plain visualizing.

4. Next step (I think) would be to visualize the food web by each slough , showing the means only of the primary food web constituents (from step 3). Include both summer and fall means for the main species of fish, differentiating with  some kind of symbol, or in separate plots.
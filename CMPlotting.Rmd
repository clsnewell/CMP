---
title: "CMPlotting"
author: "Caroline Newell"
date: "4/3/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---
##Load packages
```{r}
library(readxl)
library(lubridate)
library(viridis)
library(RColorBrewer)
library(ggpubr)
#library(cowplot)
library(ggsci)
#library(Rmisc)
library(tidyverse)
standard_error <- function(x) sd(x) / sqrt(length(x)) # Create own function
```

```{r}
#Standard_ErrorTheme<- 
```
# Plot Fish Data

##Liver
```{r}
FishIsotopeAndMetaData_040322 <- read_excel("Data/FishIsotopeAndMetaData_040322.xlsx")

FishLiverDataSummarized_040422 <- read_excel("Data/FishLiverDataSummarized_040422.xlsx")

FishLiverDataSummarized_040422$`D13CVPDB(permill)`<- as.numeric(FishLiverDataSummarized_040422$`D13CVPDB(permill)`)

FishLiverDataSummarized_040422$`D15NAir(permill)`<- as.numeric(FishLiverDataSummarized_040422$`D15NAir(permill)`)

FishLiverDataSummarized_040422$`D34SVCDT(permill)`<- as.numeric(FishLiverDataSummarized_040422$`D34SVCDT(permill)`)

FishLiverDataSummarized_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~Species) + labs(title= "Fish Liver Data from all Seasons")


FishLiverDataSummarized_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point()

unique(FishLiverDataSummarized_040422$Species)

FishLiverDataSummarized_040422 %>% filter(Season == "Summer") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Liver Data from Summer")

FishLiverDataSummarized_040422 %>% filter(Season == "Fall") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Liver Data from Fall")
```

## Muscle
```{r}
FishIsotopeAndMetaData_040322 <- read_excel("Data/FishIsotopeAndMetaData_040322.xlsx")

FishMuscleDataSummarized_040422 <- read_excel("Data/FishMuscleDataSummarized_040422.xlsx")

FishMuscleDataSummarized_040422$`D13CVPDB(permill)`<- as.numeric(FishMuscleDataSummarized_040422$`D13CVPDB(permill)`)

FishMuscleDataSummarized_040422$`D15NAir(permill)`<- as.numeric(FishMuscleDataSummarized_040422$`D15NAir(permill)`)

FishMuscleDataSummarized_040422$`D34SVCDT(permill)`<- as.numeric(FishMuscleDataSummarized_040422$`D34SVCDT(permill)`)

FishMuscleDataSummarized_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~Species) + labs(title= "Fish Muscle Data from all Seasons")

```

Teejay asks: "Can we organize the fishes by community type rather than alphabetically (e.g., TFS, ASH, ISS, SB all together)?  And can we split 'em by seasons - lump June/July fish, then Sept fish?  At least for YOY SB and SCP."

```{r}
facet_wrap(~factor(Season, levels = c("Summer", "Fall")))

unique(FishMuscleDataSummarized_040422$Species)

FishMuscleDataSummarized_040422 %>% filter(Season == "Summer") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Muscle Data from Summer")

FishMuscleDataSummarized_040422 %>% filter(Season == "Fall") %>%  ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color=Site)) + facet_wrap(~factor(Species, levels = c("TFS", "ASH", "ISS", "SB", "ST", "BC", "TP", "STBK", "SKR", "CP", "SF", "SCP", "SG", "SKG", "YFG"))) + labs(title= "Fish Muscle Data from Fall")
```

# Plot plant data
```{r}
PlantIsotopeAndMetaData_040422 <- read_excel("Data/PlantIsotopeAndMetaData_040422.xlsx")

PlantIsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(PlantIsotopeAndMetaData_040422$`D13CVPDB(permill)`)

PlantIsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(PlantIsotopeAndMetaData_040422$`D15NAir(permill)`)

PlantIsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(PlantIsotopeAndMetaData_040422$`D34SVCDT(permill)`)

glimpse(PlantIsotopeAndMetaData_040422)

PlantIsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~SpeciesCode) + labs(title = "Plant Data all Seasons")

PlantIsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~factor(SpeciesCode, levels = c("DET", "SAGO", "MYSP", "FILA", "PHAU", "TYAN", "SCAC", "SCAM", "SCCA", "LEMNA", "AZFI", "ARSU", "SAPA", "CASE", "JACA", "LELA", "ROCA", "LAJE", "JUBA", "LOCO", "PLOD"))) + labs(title = "Plant Species Data all Seasons")

PlantIsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~Class) + labs(title = "Plant Data all Seasons")

```

# Plot Big Invert Data
```{r}
LargeMacroinvert_IsotopeAndMetaData_040422 <- read_excel("Data/LargeMacroinvert_IsotopeAndMetaData_040422.xlsx")

LargeMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~Species) + labs(title = "Large Invert Data all Seasons")

```

# Plot Small Inverts
```{r}
SmallMacroinvert_IsotopeAndMetaData_040422 <- read_excel("Data/SmallMacroinvert_IsotopeAndMetaData_040422.xlsx")

SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~Species) + labs(title = "Small Invert Data all Seasons")
```

# Plot Zoop data
```{r}
ZoopIsotopeAndMetaData_040722 <- read_excel("Data/ZoopIsotopeAndMetaData_040722_edited.xlsx")

ZoopIsotopeAndMetaData_040722 %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~ZoopSpecies) + labs(title = "Zoop Data all Seasons")
```

#Plot POM data
```{r}
POM_BA_IsotopeAndMetaData_040522 <- read_excel("Data/POM_BA_IsotopeAndMetaData_040522.xlsx")
View(POM_BA_IsotopeAndMetaData_040522)
glimpse(POM_BA_IsotopeAndMetaData_040522)

POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`)

#Remove rows with uncertain sites.
POM_BA_IsotopeAndMetaData<- POM_BA_IsotopeAndMetaData_040522[!(POM_BA_IsotopeAndMetaData_040522$Site == "SD or SM" | POM_BA_IsotopeAndMetaData_040522$Site == "NA"),]

View(POM_BA_IsotopeAndMetaData)

POM_BA_IsotopeAndMetaData %>% ggplot(aes(x=`D13CVPDB(permill)`, y= `D15NAir(permill)`)) + geom_point(aes(color = Site))+facet_wrap(~`Sample Type`) + labs(title = "POM and BA Data all Seasons")

```


# 1. For organisms captured in both summer and fall, a plot of all data, differentiated by season by color ( if you want to include sites use symbols). Include a mean with standard error overlaying the data points. Main sp for which we have data: SB, ST, TP, SCP, SG, YFG

Which species were captured in both summer and fall?
## Fish Livers Caught Both Seasons
```{r}
#I'm going to filter the data for species that were captured in both summer and fall.
#Use all Zoops, POM, BA. BUT I need to determine which inverts, fish, and plants were sampled both seasons...

FishLiverData_040722 <- read_excel("Data/FishLiverData_040722.xlsx")

FishLiversSummer<-subset(FishLiverData_040722, Season == "Summer")
FishLiversFall<-subset(FishLiverData_040722, Season == "Fall")

FishLiversBothSeasons<- inner_join(FishLiversFall, FishLiversSummer, by= "Species")

unique(FishLiversSummer$Species)
unique(FishLiversFall$Species)
unique(FishLiversBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons: "SB"  "ST"  "YFG" "SG"  "SCP" "SKG" "TP". NOTE These are just generally caught both seasons. Not necessarily caught both seasons at all sites.

#Now filter out just these fish species from liver data

unique(FishLiverData_040722$Species)

FishLiverData_SpeciesBothSeasons<- FishLiverData_040722 %>% filter(Species %in% c("SB",  "ST",  "YFG", "SG",  "SCP", "SKG", "TP"))

unique(FishLiverData_SpeciesBothSeasons$NComment)
#There is no fish livers (for species of interest) with carbon comments. One SB had an N comment that it contained more nitrogen than the largest reference, but the value isn't that far out. So I don't feel a need to remove any.

#Okay, now I want to get the average, sd, 95%CI of C and N values for these fish livers.
View(FishLiverData_SpeciesBothSeasons)
#Confidence interval using t-test distribution.
FishLivers_BothSeasons_MeansSd<-FishLiverData_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season, `Age Class`) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

FishLivers_BothSeasons_MeansSd$D13C_StdError[is.nan(FishLivers_BothSeasons_MeansSd$D13C_StdError)]<-0

FishLivers_BothSeasons_MeansSd$D13C_StdError[is.na(FishLivers_BothSeasons_MeansSd$D13C_StdError)]<-0

FishLivers_BothSeasons_MeansSd$D13C_SD[is.nan(FishLivers_BothSeasons_MeansSd$D13C_SD)]<-0

FishLivers_BothSeasons_MeansSd$D13C_UCI[is.nan(FishLivers_BothSeasons_MeansSd$D13C_UCI)]<-0

FishLivers_BothSeasons_MeansSd$D13C_LCI[is.nan(FishLivers_BothSeasons_MeansSd$D13C_LCI)]<-0

FishLivers_BothSeasons_MeansSd$D15N_StdError[is.nan(FishLivers_BothSeasons_MeansSd$D15N_StdError)]<-0

FishLivers_BothSeasons_MeansSd$D15N_StdError[is.na(FishLivers_BothSeasons_MeansSd$D15N_StdError)]<-0

FishLivers_BothSeasons_MeansSd$D15N_SD[is.nan(FishLivers_BothSeasons_MeansSd$D15N_SD)]<-0

FishLivers_BothSeasons_MeansSd$D15N_UCI[is.nan(FishLivers_BothSeasons_MeansSd$D15N_UCI)]<-0

FishLivers_BothSeasons_MeansSd$D15N_LCI[is.nan(FishLivers_BothSeasons_MeansSd$D15N_LCI)]<-0

#plot!
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#CC79A7")

Liver_Seasons<- FishLivers_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  scale_shape_manual(values=rep(0:6, 1))+
  #scale_size_manual(values=c(10))+
  #geom_text(aes(label=Species), hjust=1.25, vjust = 1) +
  labs(title = "Liver Means And Standard Error from Summer and Fall") +
  theme_bw()+ 
  #coord_cartesian(ylim=c(10, 23))+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Liver_Seasons
```

## Fish Muscles
```{r}
#Now do the same for muscle.
FishMuscleData_040722 <- read_excel("Data/FishMuscleData_040722.xlsx")

FishMuscle_Summer<-subset(FishMuscleData_040722, Season == "Summer")
FishMusclesFall<-subset(FishMuscleData_040722, Season == "Fall")

FishMusclessBothSeasons<- inner_join(FishMuscle_Summer, FishMusclesFall, by= "Species")

unique(FishMusclessBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons: "SCP" "ST"  "TP"  "SB"  "YFG" "SKG" "SG"

#Now filter out just these fish species from muscle data

unique(FishMuscleData_040722$Species)

FishMuscleData_SpeciesBothSeasons<- FishMuscleData_040722 %>% filter(Species %in% c("SCP", "ST",  "TP",  "SB",  "YFG", "SKG", "SG"))

#Okay, now I want to get the average and sd of C and N values for these fish livers.
#View(FishMuscleData_SpeciesBothSeasons)

FishMuscleData_SpeciesBothSeasons$`D13CVPDB(permill)`<- as.numeric(FishMuscleData_SpeciesBothSeasons$`D13CVPDB(permill)`)

FishMuscleData_SpeciesBothSeasons$`D15NAir(permill)`<- as.numeric(FishMuscleData_SpeciesBothSeasons$`D15NAir(permill)`)

FishMuscleData_SpeciesBothSeasons$`D34SVCDT(permill)`<- as.numeric(FishMuscleData_SpeciesBothSeasons$`D34SVCDT(permill)`)

#Checking for outliers.
unique(FishMuscleData_SpeciesBothSeasons$NComment)
unique(FishMuscleData_SpeciesBothSeasons$C_Comment)
#ST from PT may have been mixed up with a YFG but the values for ST seem within reason.
#The YFG has a really low N value compared to the others. So it may be incorrect. So it is possible they actually did get mixed up.. Just remove them all? 
FishMuscleData_SpeciesBothSeasons<-FishMuscleData_SpeciesBothSeasons %>% filter(!NComment %in% "H3-H6 could be mixed up")
unique(FishMuscleData_SpeciesBothSeasons$NComment)

FishMuscles_BothSeasons_MeansSd<-FishMuscleData_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season, `Age Class`) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

FishMuscles_BothSeasons_MeansSd$D13C_StdError[is.nan(FishMuscles_BothSeasons_MeansSd$D13C_StdError)]<-0

FishMuscles_BothSeasons_MeansSd$D13C_StdError[is.na(FishMuscles_BothSeasons_MeansSd$D13C_StdError)]<-0

FishMuscles_BothSeasons_MeansSd$D13C_SD[is.nan(FishMuscles_BothSeasons_MeansSd$D13C_SD)]<-0

FishMuscles_BothSeasons_MeansSd$D13C_UCI[is.nan(FishMuscles_BothSeasons_MeansSd$D13C_UCI)]<-0

FishMuscles_BothSeasons_MeansSd$D13C_LCI[is.nan(FishMuscles_BothSeasons_MeansSd$D13C_LCI)]<-0

FishMuscles_BothSeasons_MeansSd$D15N_StdError[is.nan(FishMuscles_BothSeasons_MeansSd$D15N_StdError)]<-0

FishMuscles_BothSeasons_MeansSd$D15N_StdError[is.na(FishMuscles_BothSeasons_MeansSd$D15N_StdError)]<-0

FishMuscles_BothSeasons_MeansSd$D15N_SD[is.nan(FishMuscles_BothSeasons_MeansSd$D15N_SD)]<-0

FishMuscles_BothSeasons_MeansSd$D15N_UCI[is.nan(FishMuscles_BothSeasons_MeansSd$D15N_UCI)]<-0

FishMuscles_BothSeasons_MeansSd$D15N_LCI[is.nan(FishMuscles_BothSeasons_MeansSd$D15N_LCI)]<-0

Muscle_Seasons<- FishMuscles_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  scale_shape_manual(values=rep(0:6, 1))+
  #geom_text(aes(label=Species), hjust=1.25, vjust = 1) +
  labs(title = "Fish Muscle Means And Standard Error from Summer and Fall") +
  theme_bw()+
  #coord_cartesian(ylim=c(10, 23),  xlim=c(-31, -18))+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) +
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Muscle_Seasons 

#max(FishMuscles_BothSeasons_MeansSd$D13C_UCI)
#min(FishMuscles_BothSeasons_MeansSd$D13C_LCI)
```


## Big Inverts 
```{r}
#Went through and manually deleted all the columns for rows which had incorrect readings due to combustion column failure. 

LargeMacroinvert_IsotopeAndMetaData_040822 <- read_excel("Data/LargeMacroinvert_IsotopeAndMetaData_040822_Edited.xlsx")

LargeMacroinvert_IsotopeAndMetaData_040822$`D13CVPDB(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D13CVPDB(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040822$`D15NAir(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D15NAir(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040822$`D34SVCDT(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D34SVCDT(permill)`)

View(LargeMacroinvert_IsotopeAndMetaData_040822)

#Introduce Season column
LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date<-mdy(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date)

str(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date)

LargeMacroinvert_IsotopeAndMetaData_040822$Month<- format(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date, format = "%m")
unique(LargeMacroinvert_IsotopeAndMetaData_040822$Month)

LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "06"]<-"Summer"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "07"]<-"Summer"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "08"]<-"Fall"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "09"]<-"Fall"
View(LargeMacroinvert_IsotopeAndMetaData_040822)


BigInvertsSummer<-subset(LargeMacroinvert_IsotopeAndMetaData_040822, Season == "Summer")
BigInvertsFall<-subset(LargeMacroinvert_IsotopeAndMetaData_040822, Season == "Fall")

BigInvertsBothSeasons<- inner_join(BigInvertsFall, BigInvertsSummer, by= "Species")

unique(BigInvertsBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons: "Corbicula" "Exopalaemon"       "Harris mud crab"    "Maeotias" "Red swamp crayfish"
#Now filter out just these  species from big invert data

unique(LargeMacroinvert_IsotopeAndMetaData_040822$Species)
#Looks like we already have all the species. cool.

#Okay, now I want to get the average and sd of C and N values for these inverts.
View(LargeMacroinvert_IsotopeAndMetaData_040822)

unique(BigInvertsBothSeasons$C_Comment.y)
#Already removed all outliers manually in excel (samples which the combustion column failed)

BigInverts_BothSeasons_MeansSd<-LargeMacroinvert_IsotopeAndMetaData_040822%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

BigInverts_BothSeasons_MeansSd$D13C_StdError[is.nan(BigInverts_BothSeasons_MeansSd$D13C_StdError)]<-0

BigInverts_BothSeasons_MeansSd$D13C_StdError[is.na(BigInverts_BothSeasons_MeansSd$D13C_StdError)]<-0

BigInverts_BothSeasons_MeansSd$D13C_SD[is.nan(BigInverts_BothSeasons_MeansSd$D13C_SD)]<-0

BigInverts_BothSeasons_MeansSd$D13C_UCI[is.nan(BigInverts_BothSeasons_MeansSd$D13C_UCI)]<-0

BigInverts_BothSeasons_MeansSd$D13C_LCI[is.nan(BigInverts_BothSeasons_MeansSd$D13C_LCI)]<-0

BigInverts_BothSeasons_MeansSd$D15N_StdError[is.nan(BigInverts_BothSeasons_MeansSd$D15N_StdError)]<-0

BigInverts_BothSeasons_MeansSd$D15N_StdError[is.na(BigInverts_BothSeasons_MeansSd$D15N_StdError)]<-0

BigInverts_BothSeasons_MeansSd$D15N_SD[is.nan(BigInverts_BothSeasons_MeansSd$D15N_SD)]<-0

BigInverts_BothSeasons_MeansSd$D15N_UCI[is.nan(BigInverts_BothSeasons_MeansSd$D15N_UCI)]<-0

BigInverts_BothSeasons_MeansSd$D15N_LCI[is.nan(BigInverts_BothSeasons_MeansSd$D15N_LCI)]<-0

BigInverts_BothSeasons_MeansSd$Site[BigInverts_BothSeasons_MeansSd$Site %in% "SB"]<-"FM"


BigInverts_Seasons<- BigInverts_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  #scale_shape_manual(values=rep(0:6, 1))+
  #geom_text(aes(label=Species), hjust=1.25, vjust = 1) +
  labs(title = "Big Inverts Means And Standard Error from Summer and Fall") +
  theme_bw()+
  #coord_cartesian(xlim=c(-35, -20))+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) +
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
BigInverts_Seasons
```

## Small Inverts 
```{r}
SmallMacroinvert_IsotopeAndMetaData_040422 <- read_excel("Data/SmallMacroinvert_IsotopeAndMetaData_040422.xlsx")

SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`)

#View(SmallMacroinvert_IsotopeAndMetaData_040422)

SmallInvertsSummer<-subset(SmallMacroinvert_IsotopeAndMetaData_040422, Season == "Summer")
unique(SmallInvertsSummer$Species)

SmallInvertsFall<-subset(SmallMacroinvert_IsotopeAndMetaData_040422, Season == "Fall")
unique(SmallInvertsFall$Species)


SmallInvertsBothSeasons<- inner_join(SmallInvertsFall, SmallInvertsSummer, by= "Species")

unique(SmallInvertsBothSeasons$Species)
#Okay, if I did this right, these are the species we caught both seasons:[1] "Americorophium spinicorne", "Crab Zoea", "Eogammarus confervicolus", "Gammarus daiberi", "Gnorimosphaeroma insulare"
#Now filter out just these  species from big invert data
#View(SmallInvertsBothSeasons)


SmallInverts_SpeciesBothSeasons<- SmallMacroinvert_IsotopeAndMetaData_040422 %>% filter(Species %in% c("Americorophium spinicorne", "Crab Zoea", "Eogammarus confervicolus", "Gammarus daiberi", "Gnorimosphaeroma insulare"))
unique(SmallInverts_SpeciesBothSeasons$C_Comment) #No warnings, all data should be okay.
#Just kidding the isopods are weird. Do calculation independently later to see where it went wrong.
#View(SmallInverts_SpeciesBothSeasons)

#Okay, now I want to get the average and sd of C and N values for these inverts.
SmallInverts_BothSeasons_MeansSd<-SmallInverts_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

SmallInverts_BothSeasons_MeansSd$D13C_StdError[is.nan(SmallInverts_BothSeasons_MeansSd$D13C_StdError)]<-0

SmallInverts_BothSeasons_MeansSd$D13C_StdError[is.na(SmallInverts_BothSeasons_MeansSd$D13C_StdError)]<-0

SmallInverts_BothSeasons_MeansSd$D13C_SD[is.nan(SmallInverts_BothSeasons_MeansSd$D13C_SD)]<-0

SmallInverts_BothSeasons_MeansSd$D13C_UCI[is.nan(SmallInverts_BothSeasons_MeansSd$D13C_UCI)]<-0

SmallInverts_BothSeasons_MeansSd$D13C_LCI[is.nan(SmallInverts_BothSeasons_MeansSd$D13C_LCI)]<-0

SmallInverts_BothSeasons_MeansSd$D15N_StdError[is.nan(SmallInverts_BothSeasons_MeansSd$D15N_StdError)]<-0

SmallInverts_BothSeasons_MeansSd$D15N_StdError[is.na(SmallInverts_BothSeasons_MeansSd$D15N_StdError)]<-0

SmallInverts_BothSeasons_MeansSd$D15N_SD[is.nan(SmallInverts_BothSeasons_MeansSd$D15N_SD)]<-0

SmallInverts_BothSeasons_MeansSd$D15N_UCI[is.nan(SmallInverts_BothSeasons_MeansSd$D15N_UCI)]<-0

SmallInverts_BothSeasons_MeansSd$D15N_LCI[is.nan(SmallInverts_BothSeasons_MeansSd$D15N_LCI)]<-0

SmallInverts_Seasons<- SmallInverts_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  #scale_shape_manual(values=rep(0:6, 1))+
  labs(title = "Small Invert Means And Standard Error from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) +
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
SmallInverts_Seasons 
View(SmallInverts_BothSeasons_MeansSd)
```

## Plants
```{r}
PlantIsotopeAndMetaData_040822 <- read_excel("Data/PlantIsotopeAndMetaData_040822.xlsx")
#View(PlantIsotopeAndMetaData_040822)
Plants_Summer<-subset(PlantIsotopeAndMetaData_040822, Season == "Summer")
PlantsFall<-subset(PlantIsotopeAndMetaData_040822, Season == "Fall")

PlantsBothSeasons<- inner_join(Plants_Summer, PlantsFall, by= "Species")

unique(PlantsBothSeasons$Species)
#Okay, if I did this right, these are the species we sampled both seasons: "Sarcocornia/Salicornia pacifica", "Schoenoplectus acutusa", "Typha angustifolia", "Rosa californica", "Calystegia sepium", "Phragmites australis", "SAGO", "Myriophyllum spicatum", "Lemna sp", "Filamentous algae", "Lathyrus jepsonii jepsonii", "Schoenoplectus americanus", "Det"

#Now filter out just these  species 

unique(PlantIsotopeAndMetaData_040822$Species)

Plants_SpeciesBothSeasons<- PlantIsotopeAndMetaData_040822 %>% filter(Species %in% c("Sarcocornia/Salicornia pacifica", "Schoenoplectus acutusa", "Typha angustifolia", "Rosa californica", "Calystegia sepium", "Phragmites australis", "SAGO", "Myriophyllum spicatum", "Lemna sp", "Filamentous algae", "Lathyrus jepsonii jepsonii", "Schoenoplectus americanus", "Det"))

#Okay, now I want to get the average and sd of C and N values for these fish livers.
#View(Plants_SpeciesBothSeasons)

Plants_SpeciesBothSeasons$`D13CVPDB(permill)`<- as.numeric(Plants_SpeciesBothSeasons$`D13CVPDB(permill)`)

Plants_SpeciesBothSeasons$`D15NAir(permill)`<- as.numeric(Plants_SpeciesBothSeasons$`D15NAir(permill)`)

Plants_SpeciesBothSeasons$`D34SVCDT(permill)`<- as.numeric(Plants_SpeciesBothSeasons$`D34SVCDT(permill)`)

#NEED TO STILL LOOK AT OUTLIERS AND THE EFFECTS OF TAP WATER VS DI!

#Okay, now I want to get the average and sd of C and N values for these inverts.

Plants_BothSeasons_MeansSd<-Plants_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

Plants_BothSeasons_MeansSd$D13C_StdError[is.nan(Plants_BothSeasons_MeansSd$D13C_StdError)]<-0

Plants_BothSeasons_MeansSd$D13C_StdError[is.na(Plants_BothSeasons_MeansSd$D13C_StdError)]<-0

Plants_BothSeasons_MeansSd$D13C_SD[is.nan(Plants_BothSeasons_MeansSd$D13C_SD)]<-0

Plants_BothSeasons_MeansSd$D13C_UCI[is.nan(Plants_BothSeasons_MeansSd$D13C_UCI)]<-0

Plants_BothSeasons_MeansSd$D13C_LCI[is.nan(Plants_BothSeasons_MeansSd$D13C_LCI)]<-0

Plants_BothSeasons_MeansSd$D15N_StdError[is.nan(Plants_BothSeasons_MeansSd$D15N_StdError)]<-0

Plants_BothSeasons_MeansSd$D15N_StdError[is.na(Plants_BothSeasons_MeansSd$D15N_StdError)]<-0

Plants_BothSeasons_MeansSd$D15N_SD[is.nan(Plants_BothSeasons_MeansSd$D15N_SD)]<-0

Plants_BothSeasons_MeansSd$D15N_UCI[is.nan(Plants_BothSeasons_MeansSd$D15N_UCI)]<-0

Plants_BothSeasons_MeansSd$D15N_LCI[is.nan(Plants_BothSeasons_MeansSd$D15N_LCI)]<-0

#Remove SAGO with NA site info.
Plants_BothSeasons_MeanSd<-Plants_BothSeasons_MeansSd[!(Plants_BothSeasons_MeansSd$Season=="NA"),]
unique(Plants_BothSeasons_MeanSd$Site)

Plants_Seasons<- Plants_BothSeasons_MeanSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  scale_shape_manual(values=rep(0:13, 1))+
  labs(title = "Plant Means And Standard Error from Summer and Fall") +
  theme_bw()+
  #coord_cartesian(xlim=c(-45, -10))+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) +
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Plants_Seasons 
```

## POM/BA
```{r}
POM_BA_IsotopeAndMetaData_040522 <- read_excel("Data/POM_BA_IsotopeAndMetaData_040522.xlsx")
View(POM_BA_IsotopeAndMetaData_040522)
str(POM_BA_IsotopeAndMetaData_040522$Date)
#Introduce Season column
POM_BA_IsotopeAndMetaData_040522$Month<- format(POM_BA_IsotopeAndMetaData_040522$Date, format = "%m")
unique(POM_BA_IsotopeAndMetaData_040522$Month)

POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "06"]<-"Summer"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "07"]<-"Summer"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "08"]<-"Fall"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "09"]<-"Fall"
View(POM_BA_IsotopeAndMetaData_040522)

#Okay, now I want to get the average and sd of C and N values for POM and BA by site and season.

POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`)
```

```{r}
#Lets look at how far off the samples with warnings are from the samples without warnings
POM_BA_IsotopeAndMetaData_040522<-POM_BA_IsotopeAndMetaData_040522[!(POM_BA_IsotopeAndMetaData_040522$Site=="NA" | POM_BA_IsotopeAndMetaData_040522$Site=="SD or SM"),]

Carbon_OutlierPlot_POM<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "POM") %>%  ggplot(aes(x = Site, y=`D13CVPDB(permill)`)) + geom_boxplot(aes(color=C_Comment))+theme_bw() + labs(title = "POM Carbon Outlier Check from Summer and Fall")+facet_wrap(~Season)

Carbon_OutlierPlot_POM

Nitrogen_OutlierPlot_POM<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "POM") %>%  ggplot(aes(x = Site, y=`D15NAir(permill)`)) + geom_boxplot(aes(color=NComment))+theme_bw() + labs(title = "POM Nitrogen Outlier Check from Summer and Fall")+facet_wrap(~Season)

Nitrogen_OutlierPlot_POM

Carbon_OutlierPlot_BA<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "Benthic") %>%  ggplot(aes(x = Site, y=`D13CVPDB(permill)`)) + geom_boxplot(aes(color=C_Comment))+theme_bw() + labs(title = "Benthic Alge Carbon Outlier Check from Summer and Fall")+facet_wrap(~Season)

Carbon_OutlierPlot_BA

Nitrogen_OutlierPlot_BA<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "Benthic") %>%  ggplot(aes(x = Site, y=`D15NAir(permill)`)) + geom_boxplot(aes(color=NComment))+theme_bw() + labs(title = "Benthic Algae Nitrogen Outlier Check from Summer and Fall")+facet_wrap(~Season)

Nitrogen_OutlierPlot_BA
```

Outlier anaylsis results: I plotted boxplots of POM and BA data by site and season to look for N and C outliers and color coded to see which data belonged to flagged rows. 
For POM Carbon, there were outliers BUT they all belonged to rows with no comments from the SIF lab. No action needed.

For POM Nitrogen, there were some outliers belonging to "Precision decreases for samples containing less than 20 mu grams of N." Remove those belonging to that comment group which fell outside the range of the no comment group.
List: CMP-POM-110-CN, CMP-POM-135-CN, CMP-POM-36-CN, CMP-POM-150-CN, CMP-POM-150rep-CN, CMP-POM-151-CN, CMP-POM-93-CN, CMP-POM-94-CN, CMP-POM-156-CN, CMP-POM-146-CN, CMP-POM-159-CN, CMP-POM-170-CN, CMP-POM-171-CN.

For BA Carbon, all of the samples belonging to "Contained more carbon than the largest reference" was an outlier. Also true for the comments "Mass 44 & 45 saturated, totals underestimated" and "Mass 45 saturated; estimated value used." Remove them. 

For BA Nitrogen, any with the comment, "Contained more nitrogen than largest reference" was an outlier. Remove them. 

```{r}
#unique(POM_BA_IsotopeAndMetaData_040522$NComment)
#BA_OutliersRemoved<-POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type`=="Benthic") %>% subset(NComment!="Contained more nitrogen than largest reference")
#unique(BA_OutliersRemoved$C_Comment) #Cool, deleting the problematic N comments also deleted the problematic C comments.

POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` =="POM") %>% filter(NComment == "NA") %>% filter(Site == "SD", Season== "Summer") %>%  summary(`D15NAir(permill)`)

#I used the min and max of the pom samples for each site and season to determine which rows to remove of POM that were flagged by SIF. These samples have issues with nitrogen values.

POMBA_OutliersRemoved<- POM_BA_IsotopeAndMetaData_040522[!POM_BA_IsotopeAndMetaData_040522$CarolinesLabel %in% c("CMP-POM-110-CN", "CMP-POM-135-CN", "CMP-POM-36-CN", "CMP-POM-150-CN", "CMP-POM-150rep-CN", "CMP-POM-151-CN", "CMP-POM-93-CN", "CMP-POM-94-CN", "CMP-POM-156-CN", "CMP-POM-146-CN", "CMP-POM-159-CN", "CMP-POM-170-CN", "CMP-POM-171-CN", "CMP-BA-51-CN", "CMP-BA-52-CN", "CMP-BA-192-CN"),]

unique(POM_OutliersRemoved$CarolinesLabel)

View(POMBA_OutliersRemoved)  
```

```{r}
#Okay, now I want to get the average and sd of C and N values for these inverts.

POMBA_BothSeasons_MeansSd<-POMBA_OutliersRemoved%>% 
  group_by(`Sample Type`, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

POMBA_BothSeasons_MeansSd$D13C_StdError[is.nan(POMBA_BothSeasons_MeansSd$D13C_StdError)]<-0

POMBA_BothSeasons_MeansSd$D13C_StdError[is.na(POMBA_BothSeasons_MeansSd$D13C_StdError)]<-0

POMBA_BothSeasons_MeansSd$D13C_SD[is.nan(POMBA_BothSeasons_MeansSd$D13C_SD)]<-0

POMBA_BothSeasons_MeansSd$D13C_UCI[is.nan(POMBA_BothSeasons_MeansSd$D13C_UCI)]<-0

POMBA_BothSeasons_MeansSd$D13C_LCI[is.nan(POMBA_BothSeasons_MeansSd$D13C_LCI)]<-0

POMBA_BothSeasons_MeansSd$D15N_StdError[is.nan(POMBA_BothSeasons_MeansSd$D15N_StdError)]<-0

POMBA_BothSeasons_MeansSd$D15N_StdError[is.na(POMBA_BothSeasons_MeansSd$D15N_StdError)]<-0

POMBA_BothSeasons_MeansSd$D15N_SD[is.nan(POMBA_BothSeasons_MeansSd$D15N_SD)]<-0

POMBA_BothSeasons_MeansSd$D15N_UCI[is.nan(POMBA_BothSeasons_MeansSd$D15N_UCI)]<-0

POMBA_BothSeasons_MeansSd$D15N_LCI[is.nan(POMBA_BothSeasons_MeansSd$D15N_LCI)]<-0

#Remove Sites NA, SD or SM
unique(POMBA_BothSeasons_MeansSd$Site)
#POMBA_BothSeasons_MeanSd<-POMBA_BothSeasons_MeansSd[!(POMBA_BothSeasons_MeansSd$Site=="NA" | POMBA_BothSeasons_MeansSd$Site=="SD or SM"),]
#unique(POMBA_BothSeasons_MeanSd$Site)
POMBA_Seasons<- POMBA_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=`Sample Type`), size=3) + 
  labs(title = "POM and BA Means And Standard Error from Summer and Fall") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) +
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
POMBA_Seasons 
```
## Zoops
```{r}
ZoopIsotopeAndMetaData_040722_edited <- read_excel("Data/ZoopIsotopeAndMetaData_040722_edited.xlsx")
ZoopIsotopeAndMetaData_040722_edited$Species<-ZoopIsotopeAndMetaData_040722_edited$ZoopSpecies
Zoops_Summer<-subset(ZoopIsotopeAndMetaData_040722_edited, Season == "Summer")
ZoopsFall<-subset(ZoopIsotopeAndMetaData_040722_edited, Season == "Fall")

ZoopsBothSeasons<- inner_join(Zoops_Summer, ZoopsFall, by= "Species")

unique(ZoopsBothSeasons$Species)
#Okay, if I did this right, these are the species we sampled both seasons: ">500 um",     "200-500 um",  "A. sinensis", "P. forbesi", "100-500 um" 

#Now filter out just these  species 

unique(ZoopIsotopeAndMetaData_040722_edited$Species)

Zoops_SpeciesBothSeasons<- ZoopIsotopeAndMetaData_040722_edited %>% filter(Species %in% c( ">500 um", "200-500 um", "A. sinensis", "P. forbesi", "100-500 um"))

#Lets look for outliers
unique(Zoops_SpeciesBothSeasons$NComment) #Looks like an okay sample. Gonna leave it.

#Okay, now I want to get the average and sd of C and N values for these fish livers.
View(Zoops_SpeciesBothSeasons)

Zoops_SpeciesBothSeasons$`D13CVPDB(permill)`<- as.numeric(Zoops_SpeciesBothSeasons$`D13CVPDB(permill)`)

Zoops_SpeciesBothSeasons$`D15NAir(permill)`<- as.numeric(Zoops_SpeciesBothSeasons$`D15NAir(permill)`)

Zoops_SpeciesBothSeasons$`D34SVCDT(permill)`<- as.numeric(Zoops_SpeciesBothSeasons$`D34SVCDT(permill)`)

Zoops_BothSeasons_MeansSd<-Zoops_SpeciesBothSeasons%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

Zoops_BothSeasons_MeansSd$D13C_StdError[is.nan(Zoops_BothSeasons_MeansSd$D13C_StdError)]<-0

Zoops_BothSeasons_MeansSd$D13C_StdError[is.na(Zoops_BothSeasons_MeansSd$D13C_StdError)]<-0

Zoops_BothSeasons_MeansSd$D13C_SD[is.nan(Zoops_BothSeasons_MeansSd$D13C_SD)]<-0

Zoops_BothSeasons_MeansSd$D13C_UCI[is.nan(Zoops_BothSeasons_MeansSd$D13C_UCI)]<-0

Zoops_BothSeasons_MeansSd$D13C_LCI[is.nan(Zoops_BothSeasons_MeansSd$D13C_LCI)]<-0

Zoops_BothSeasons_MeansSd$D15N_StdError[is.nan(Zoops_BothSeasons_MeansSd$D15N_StdError)]<-0

Zoops_BothSeasons_MeansSd$D15N_StdError[is.na(Zoops_BothSeasons_MeansSd$D15N_StdError)]<-0

Zoops_BothSeasons_MeansSd$D15N_SD[is.nan(Zoops_BothSeasons_MeansSd$D15N_SD)]<-0

Zoops_BothSeasons_MeansSd$D15N_UCI[is.nan(Zoops_BothSeasons_MeansSd$D15N_UCI)]<-0

Zoops_BothSeasons_MeansSd$D15N_LCI[is.nan(Zoops_BothSeasons_MeansSd$D15N_LCI)]<-0


Zoops_Seasons<- Zoops_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
 # scale_shape_manual(values=rep(0:13, 1))+
  labs(title = "Zoop Means And Standard Error from Summer and Fall") +
  theme_bw()+
  coord_cartesian(ylim=c(10, 15),  xlim=c(-35, -25))+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) +
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Zoops_Seasons
```
## MEGA PLOT
```{r}
#Make columns match
Zoop_SpeciesBothSeason<- Zoops_SpeciesBothSeasons[,c("Species", "Site", "Season", "D13CVPDB(permill)", "D15NAir(permill)", "SampleID")]
Zoop_SpeciesBothSeason<-Zoop_SpeciesBothSeason %>% 
  rename(SpecimenID = SampleID)

POMBA_SpeciesBothSeason<- POMBA_OutliersRemoved[,c("Sample Type", "Site", "Season", "D13CVPDB(permill)", "D15NAir(permill)", "CarolinesLabel")]
POMBA_SpeciesBothSeason<-POMBA_SpeciesBothSeason %>% 
  rename(SpecimenID = CarolinesLabel, Species=`Sample Type`)

Plant_SpeciesBothSeason<- Plants_SpeciesBothSeasons[,c("Species", "Site", "Season", "D13CVPDB(permill)", "D15NAir(permill)", "Sample_ID")]
Plant_SpeciesBothSeason<-Plant_SpeciesBothSeason %>% 
  rename(SpecimenID = Sample_ID)
Plant_SpeciesBothSeason<-Plant_SpeciesBothSeason[!(Plant_SpeciesBothSeason$Season=="NA"),]

SmallInvert_SpeciesBothSeason<- SmallInverts_SpeciesBothSeasons[,c("Species", "Site", "Season", "D13CVPDB(permill)", "D15NAir(permill)", "SampleID")]
SmallInvert_SpeciesBothSeason<-SmallInvert_SpeciesBothSeason %>% 
  rename(SpecimenID = SampleID)

LargeInvert_SpeciesBothSeason<- LargeMacroinvert_IsotopeAndMetaData_040822[,c("Species", "Site", "Season", "D13CVPDB(permill)", "D15NAir(permill)", "SpecimenID")]

FishMuscle_SpeciesBothSeason<- FishMuscleData_SpeciesBothSeasons[,c("Species", "Site", "Season", "D13CVPDB(permill)", "D15NAir(permill)", "FishSpecimenID")]
FishMuscle_SpeciesBothSeason<-FishMuscle_SpeciesBothSeason %>% 
  rename(SpecimenID = FishSpecimenID)

FishLiver_SpeciesBothSeason<- FishLiverData_SpeciesBothSeasons[,c("Species", "Site", "Season", "D13CVPDB(permill)", "D15NAir(permill)", "FishSpecimenID")]
FishLiver_SpeciesBothSeason<-FishLiver_SpeciesBothSeason %>% 
  rename(SpecimenID = FishSpecimenID)

#Bind rows
AllData<-rbind(Zoop_SpeciesBothSeason, POMBA_SpeciesBothSeason, Plant_SpeciesBothSeason, SmallInvert_SpeciesBothSeason, LargeInvert_SpeciesBothSeason, FishMuscle_SpeciesBothSeason, FishLiver_SpeciesBothSeason)

AllData$Site[AllData$Site %in% "SB"]<-"FM"


AllData_BothSeasons_MeansSd<-AllData%>% 
  group_by(Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

AllData_BothSeasons_MeansSd$D13C_SD[is.nan(AllData_BothSeasons_MeansSd$D13C_SD)]<-0

AllData_BothSeasons_MeansSd$D13C_UCI[is.nan(AllData_BothSeasons_MeansSd$D13C_UCI)]<-0

AllData_BothSeasons_MeansSd$D13C_LCI[is.nan(AllData_BothSeasons_MeansSd$D13C_LCI)]<-0

AllData_BothSeasons_MeansSd$D15N_SD[is.nan(AllData_BothSeasons_MeansSd$D15N_SD)]<-0

AllData_BothSeasons_MeansSd$D15N_UCI[is.nan(AllData_BothSeasons_MeansSd$D15N_UCI)]<-0

AllData_BothSeasons_MeansSd$D15N_LCI[is.nan(AllData_BothSeasons_MeansSd$D15N_LCI)]<-0

AllData_Seasons<- AllData_BothSeasons_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  labs(title = "All data Means And 95% CI's from Summer and Fall") +
  theme_bw()+
  #coord_cartesian(ylim=c(10, 15),  xlim=c(-35, -25))+
  geom_errorbar(aes(ymin = D15N_LCI, ymax = D15N_UCI))+
  geom_errorbarh(aes(xmin = D13C_LCI, xmax = D13C_UCI)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
AllData_Seasons

AllData_FM<-subset(AllData, Site == "FM")
AllData_HL<-subset(AllData, Site == "HL")
AllData_PT<-subset(AllData, Site == "PT")
AllData_SD<-subset(AllData, Site == "SD")
unique(AllData_SD$Species)

AllDataAcrossSites<- inner_join(AllData_FM, AllData_HL, by= "Species") %>% inner_join(AllData_PT, AllData_SD, by= "Species")
unique(AllDataAcrossSites$Species)
#okay now filter out just those species.
AllData_SpeciesBothSeasonsAllSites<- AllData %>% filter(Species %in% c( ">500 um", "A. sinensis", "P. forbesi", "Benthic", "POM", "Schoenoplectus acutusa", "Myriophyllum spicatum", "Det", "Eogammarus confervicolus",  "Gammarus daiberi", "Gnorimosphaeroma insulare", "Corbicula", "Exopalaemon", "Harris mud crab", "Maeotias", "SCP", "ST", "SB", "YFG","SG"))

AllData_BothSeasons_AllSites_MeansSd<-AllData_SpeciesBothSeasonsAllSites%>% 
  group_by(Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

AllData_BothSeasons_AllSites_MeansSd$D13C_SD[is.nan(AllData_BothSeasons_AllSites_MeansSd$D13C_SD)]<-0

AllData_BothSeasons_AllSites_MeansSd$D13C_UCI[is.nan(AllData_BothSeasons_AllSites_MeansSd$D13C_UCI)]<-0

AllData_BothSeasons_AllSites_MeansSd$D13C_LCI[is.nan(AllData_BothSeasons_AllSites_MeansSd$D13C_LCI)]<-0

AllData_BothSeasons_AllSites_MeansSd$D15N_SD[is.nan(AllData_BothSeasons_AllSites_MeansSd$D15N_SD)]<-0

AllData_BothSeasons_AllSites_MeansSd$D15N_UCI[is.nan(AllData_BothSeasons_AllSites_MeansSd$D15N_UCI)]<-0

AllData_BothSeasons_AllSites_MeansSd$D15N_LCI[is.nan(AllData_BothSeasons_AllSites_MeansSd$D15N_LCI)]<-0

AllData_SeasonsAndSites<- AllData_BothSeasons_AllSites_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site)) + 
  labs(title = "All Species Caught All Sites and Seasons Means And 95% CI's from Summer and Fall") +
  theme_bw()+
  #coord_cartesian(ylim=c(10, 15),  xlim=c(-35, -25))+
  geom_errorbar(aes(ymin = D15N_LCI, ymax = D15N_UCI))+
  geom_errorbarh(aes(xmin = D13C_LCI, xmax = D13C_UCI)) + 
  facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
AllData_SeasonsAndSites
```

###Livers
```{r}
#Bind rows
AvgData_BothSeasons_Livers<-rbind(Zoops_BothSeasons_MeansSd, POMBA_BothSeasons_MeanSd, Plants_BothSeasons_MeanSd, SmallInverts_BothSeasons_MeansSd, BigInverts_BothSeasons_MeansSd, FishLivers_BothSeasons_MeansSd)
View(AvgData_BothSeasons_Livers)
#Need to rename SB site to FM
AvgData_BothSeasons_Livers$Site[AvgData_BothSeasons_Livers$Site == "SB"] <-"FM"

AvgData_BothSeasons_Livers$Class<-AvgData_BothSeasons_Livers$`Age Class`

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("SAGO", "Myriophyllum spicatum", "Filamentous algae")]<- "SAV"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("Phragmites australis", "Typha angustifolia", "Schoenoplectus acutusa", "Schoenoplectus americanus", "Schoenoplectus californicus")]<- "EV"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("Sarcocornia/Salicornia pacifica", "Calystegia sepium", "Jaumea carnosa", "Lepidium latifolium", "Rosa californica", "Lathyrus jepsonii jepsonii", "Juncus balticus", "Lotus corniculatu", "Pluchea odorata")]<- "Terrestrial"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("Lemna sp", "Azolla")]<- "Floating Veg"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "DET"]<- "Det"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("SCP", "SG", "YFG", "SKG")]<- "Sculpin/Goby"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "ST"]<- "ST"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "TP"]<- "TP"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "SB"]<- "SB"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("Americorophium spinicorne", "Eogammarus confervicolus", "Gammarus daiberi")]<- "Scud"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("Red swamp crayfish")]<- "Red swamp crayfish"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Harris mud crab"]<- "HMC"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Maeotias"]<- "Maeotias"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Exopalaemon"]<- "EXO"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Corbicula"]<- "Corbicula"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Gnorimosphaeroma insulare"]<- "Isopod"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Crab Zoea"]<- "Crab Zoea"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "POM"]<- "POM"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Det"]<- "Det"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% "Benthic"]<- "Benthic Algae"

AvgData_BothSeasons_Livers$Class[AvgData_BothSeasons_Livers$Species %in% c("P. forbesi", "A. sinensis", "200-500 um", "100-500 um" ,">500 um")]<- "Zoop"

AvgData_BothSeasons_Livers$D15N_SD[AvgData_BothSeasons_Livers$D15N_SD %in% c("NaN", "NA")]<- "0"
AvgData_BothSeasons_Livers$D15N_SD<-as.numeric(AvgData_BothSeasons_Livers$D15N_SD)

AvgData_BothSeasons_Livers$D13C_SD[AvgData_BothSeasons_Livers$D13C_SD %in% c("NaN", "NA")]<- "0"
AvgData_BothSeasons_Livers$D13C_SD<-as.numeric(AvgData_BothSeasons_Livers$D13C_SD)

View(AvgData_BothSeasons_Livers)

unique(AvgData_BothSeasons_Livers$Class)

View(AvgData_BothSeasons_Livers)
AvgData_BothSeasons_Livers$Class<- factor(AvgData_BothSeasons_Livers$Class, levels = c("SB", "ST", "TP", "Sculpin/Goby", "Red swamp crayfish", "HMC", "Maeotias", "EXO", "Corbicula",  "Isopod", "Scud", "Crab Zoea", "Zoop", "Terrestrial", "EV", "Floating Veg", "SAV", "POM", "Benthic Algae", "Det")) #Changing level order 

Avg_BothSeasons_Livers<- AvgData_BothSeasons_Livers  %>%  ggplot(aes(D13C_mean, D15N_mean, color= Class)) + scale_shape_manual(values=rep(0:6, 7))+
  geom_point(aes(color = Class, shape = Class)) +
  scale_color_viridis_d()+
  labs(title = "All from Both Seasons - Fish livers") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) +facet_wrap(~factor(Season, levels=c("Summer", "Fall"))) #+ 
 # facet_wrap(~factor(Site))  theme(legend.position="none") + scale_color_viridis_d() +

Avg_BothSeasons_Livers

#Gotta split the seasons up. Too much data!
AvgData_Summer_Livers<-AvgData_BothSeasons_Livers %>% filter(Season %in% "Summer")
unique(AvgData_Summer_Livers$Species)
#filter(!(Species %in% c("Crab Zoea", "Gnorimosphaeroma insulare"))) + scale_color_brewer(palette = "Paired")
Avg_Summer_Livers<- AvgData_Summer_Livers  %>%  ggplot(aes(D13C_mean, D15N_mean, color= Class)) + scale_shape_manual(values=rep(0:6, 7))+
  geom_point(aes(color = Class, shape = Class)) +
  scale_color_viridis_d()+
  labs(title = "All from Summer - Fish livers") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) #+facet_wrap(~Site) #+ 
 # facet_wrap(~factor(Site))  theme(legend.position="none") + scale_color_viridis_d() +

Avg_Summer_Livers

#color_legend <-
 # AvgData_Summer_Livers %>%
  #ggplot(aes(D13C_mean, D15N_mean, color= Class)) + geom_point(aes(color = Class))
#legend <- cowplot::get_legend(color_legend)
#legend
#grid.newpage()
#grid.draw(legend)

#Shape_legend <-
 # AvgData_Summer_Livers %>%
  #ggplot(aes(D13C_mean, D15N_mean)) + geom_point(aes(shape = Species))+scale_shape_manual(values=rep(15:20, 7))

#grid.newpage()
#grid.draw(color_legend)
  
#plot_grid(
 # Avg_Summer_Livers
  #, plot_grid(
   # get_legend(color_legend)
    #, get_legend(Shape_legend)
    #, nrow = 1
#  )
 # , nrow = 2
  #, rel_heights = c(8,2)
#)

AvgData_Fall_Livers<-AvgData_BothSeasons_Livers %>% filter(Season %in% "Fall")

Avg_Fall_Livers<- AvgData_Fall_Livers  %>%  ggplot(aes(D13C_mean, D15N_mean, color= Class)) + scale_shape_manual(values=rep(0:6, 7))+
  geom_point(aes(color = Class, shape = Class)) +
  scale_color_viridis_d()+
  labs(title = "All from Fall - Fish livers") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) #+ facet_wrap(~Site)
Avg_Fall_Livers

Avg_Fall_Livers<- AvgData_Fall_Livers %>% ggplot(aes(D13C_mean, D15N_mean, color= Class)) + 
  geom_point(aes(color = Class)) +
  labs(title = "All from Fall - Fish livers") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) #+ 
  #facet_wrap(~factor(Site))
Avg_Fall_Livers
```

### Muscles
```{r}
AvgData_BothSeasons_Muscles<-rbind(Zoops_BothSeasons_MeansSd, POMBA_BothSeasons_MeanSd, Plants_BothSeasons_MeanSd, SmallInverts_BothSeasons_MeansSd, BigInverts_BothSeasons_MeansSd, FishMuscles_BothSeasons_MeansSd)

#Need to rename SB site to FM
unique(AvgData_BothSeasons_Muscles$Site)
AvgData_BothSeasons_Muscles$Site[AvgData_BothSeasons_Muscles$Site == "SB"] <-"FM"

AvgData_BothSeasons_Muscles$Class<-AvgData_BothSeasons_Muscles$`Age Class`

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("SAGO", "Myriophyllum spicatum", "Filamentous algae")]<- "SAV"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("Phragmites australis", "Typha angustifolia", "Schoenoplectus acutusa", "Schoenoplectus americanus", "Schoenoplectus californicus")]<- "EV"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("Sarcocornia/Salicornia pacifica", "Calystegia sepium", "Jaumea carnosa", "Lepidium latifolium", "Rosa californica", "Lathyrus jepsonii jepsonii", "Juncus balticus", "Lotus corniculatu", "Pluchea odorata")]<- "Terrestrial"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("Lemna sp", "Azolla")]<- "Floating Veg"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "DET"]<- "Det"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("SCP", "SG", "YFG", "SKG")]<- "Sculpin/Goby"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("SB")]<- "SB"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("TP")]<- "TP"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("ST")]<- "ST"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("Americorophium spinicorne", "Eogammarus confervicolus", "Gammarus daiberi")]<- "Scud"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Red swamp crayfish"]<- "Red swamp crayfish"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Harris mud crab"]<- "HMC"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Maeotias"]<- "Maeotias"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Exopalaemon"]<- "EXO"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Corbicula"]<- "Corbicula"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Gnorimosphaeroma insulare"]<- "Isopod"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Crab Zoea"]<- "Crab Zoea"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "POM"]<- "POM"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Det"]<- "Det"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% "Benthic"]<- "Benthic Algae"

AvgData_BothSeasons_Muscles$Class[AvgData_BothSeasons_Muscles$Species %in% c("P. forbesi", "A. sinensis", "200-500 um", "100-500 um" ,">500 um")]<- "Zoop"

AvgData_BothSeasons_Muscles$D15N_SD[AvgData_BothSeasons_Muscles$D15N_SD %in% c("NaN", "NA")]<- "0"
AvgData_BothSeasons_Muscles$D15N_SD<-as.numeric(AvgData_BothSeasons_Muscles$D15N_SD)

AvgData_BothSeasons_Muscles$D13C_SD[AvgData_BothSeasons_Muscles$D13C_SD %in% c("NaN", "NA")]<- "0"
AvgData_BothSeasons_Muscles$D13C_SD<-as.numeric(AvgData_BothSeasons_Muscles$D13C_SD)

View(AvgData_BothSeasons_Muscles)

unique(AvgData_BothSeasons_Muscles$Class)

unique(AvgData_BothSeasons_Muscles$Class)
AvgData_BothSeasons_Muscles$Class<- factor(AvgData_BothSeasons_Muscles$Class, levels = c("SB", "ST", "TP", "Sculpin/Goby", "Red swamp crayfish", "HMC", "Maeotias", "EXO", "Corbicula",  "Isopod", "Scud", "Crab Zoea", "Zoop", "Terrestrial", "EV", "Floating Veg", "SAV", "POM", "Benthic Algae", "Det")) #Changing level order 

AvgData_Summer_Muscles<- AvgData_BothSeasons_Muscles %>% filter(Season %in% "Summer")

Avg_Summer_Muscles<- AvgData_Summer_Muscles  %>%  ggplot(aes(D13C_mean, D15N_mean, color= Class)) + scale_shape_manual(values=rep(0:6, 7))+
  geom_point(aes(color = Class, shape = Class)) +
  scale_color_viridis_d()+
  labs(title = "All from Summer - Fish muscles") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) +facet_wrap(~Site) 
Avg_Summer_Muscles

AvgData_Fall_Muscles<- AvgData_BothSeasons_Muscles %>% filter(Season %in% "Fall")

Avg_Fall_Muscles<- AvgData_Fall_Muscles  %>%  ggplot(aes(D13C_mean, D15N_mean, color= Class)) + scale_shape_manual(values=rep(0:6, 7))+
  geom_point(aes(color = Class, shape = Class)) +
  scale_color_viridis_d()+
  labs(title = "All from Fall - Fish muscles") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) +facet_wrap(~Site) 
Avg_Fall_Muscles

Avg_Muscles<- AvgData_BothSeasons_Muscles  %>%  ggplot(aes(D13C_mean, D15N_mean, color= Class)) + scale_shape_manual(values=rep(0:6, 7))+
  geom_point(aes(color = Class, shape = Class)) +
  scale_color_viridis_d()+
  labs(title = "All from both seasons - Fish muscles") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean - D15N_SD, ymax = D15N_mean+ D15N_SD))+
  geom_errorbarh(aes(xmin = D13C_mean - D13C_SD, xmax = D13C_mean + D13C_SD)) +facet_wrap(~factor(Season, levels=c("Summer", "Fall")) )
Avg_Muscles

```
2. For organisms represented across most sloughs, a plot of all data differentiated by slough (aggregating seasons). Include a mean with SDS overlaying. Same species.

3. For the lower trophic level stuff, it would be good to roughly visualize approximate overlap among groups, via ordination or just plain visualizing.

4. Next step (I think) would be to visualize the food web by each slough , showing the means only of the primary food web constituents (from step 3). Include both summer and fall means for the main species of fish, differentiating with  some kind of symbol, or in separate plots.
# 2. For organisms caught in summer, species that were caught in every site? Then do for fall. Trying to understand spatial differences.
## Fish muscle
```{r}
#Now do the same for muscle.
FishMuscleData_040722 <- read_excel("Data/FishMuscleData_040722.xlsx")

FishMuscle_Summer<-filter(FishMuscleData_040722, Season == "Summer")

FishMuscle_Summer_FM<-subset(FishMuscle_Summer, Site == "FM")
FishMuscle_Summer_HL<-subset(FishMuscle_Summer, Site == "HL")
FishMuscle_Summer_PT<-subset(FishMuscle_Summer, Site == "PT")
FishMuscle_Summer_SD<-subset(FishMuscle_Summer, Site == "SD")

unique(FishMuscle_Summer_FM$Species)
unique(FishMuscle_Summer_HL$Species)
unique(FishMuscle_Summer_PT$Species)
unique(FishMuscle_Summer_SD$Species)

FishMuscle_SummerSpecies<-filter(FishMuscle_Summer, Species %in% c("SB", "SCP", "ST", "YFG"))

#Okay, now I want to get the average and standard error of C and N values for these fish muscles
FishMuscle_SummerSpecies$`D13CVPDB(permill)`<- as.numeric(FishMuscle_SummerSpecies$`D13CVPDB(permill)`)

FishMuscle_SummerSpecies$`D15NAir(permill)`<- as.numeric(FishMuscle_SummerSpecies$`D15NAir(permill)`)

FishMuscle_SummerSpecies$`D34SVCDT(permill)`<- as.numeric(FishMuscle_SummerSpecies$`D34SVCDT(permill)`)

#Checking for outliers.
unique(FishMuscle_SummerSpecies$NComment)
unique(FishMuscle_SummerSpecies$C_Comment)
#ST from PT may have been mixed up with a YFG but the values for ST seem within reason.
#The YFG has a really low N value compared to the others. So it may be incorrect. So it is possible they actually did get mixed up.. Just remove them all? 
FishMuscles_Summer_MeansSE<-FishMuscle_SummerSpecies%>% 
  group_by(Species, Site, Season, `Age Class`) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

FishMuscles_Summer_MeansSE$D13C_StdError[is.nan(FishMuscles_Summer_MeansSE$D13C_StdError)]<-0

FishMuscles_Summer_MeansSE$D13C_StdError[is.na(FishMuscles_Summer_MeansSE$D13C_StdError)]<-0

FishMuscles_Summer_MeansSE$D13C_SD[is.nan(FishMuscles_Summer_MeansSE$D13C_SD)]<-0

FishMuscles_Summer_MeansSE$D13C_UCI[is.nan(FishMuscles_Summer_MeansSE$D13C_UCI)]<-0

FishMuscles_Summer_MeansSE$D13C_LCI[is.nan(FishMuscles_Summer_MeansSE$D13C_LCI)]<-0

FishMuscles_Summer_MeansSE$D15N_StdError[is.nan(FishMuscles_Summer_MeansSE$D15N_StdError)]<-0

FishMuscles_Summer_MeansSE$D15N_StdError[is.na(FishMuscles_Summer_MeansSE$D15N_StdError)]<-0

FishMuscles_Summer_MeansSE$D15N_SD[is.nan(FishMuscles_Summer_MeansSE$D15N_SD)]<-0

FishMuscles_Summer_MeansSE$D15N_UCI[is.nan(FishMuscles_Summer_MeansSE$D15N_UCI)]<-0

FishMuscles_Summer_MeansSE$D15N_LCI[is.nan(FishMuscles_Summer_MeansSE$D15N_LCI)]<-0

Muscle_Summer<- FishMuscles_Summer_MeansSE %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  labs(title = "Fish Muscle Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Muscle_Summer

Muscle_Summer_SiteWrap<- FishMuscles_Summer_MeansSE %>% ggplot(aes(D13C_mean, D15N_mean, color= Species)) + 
  geom_point(aes(color = Species, shape=`Age Class`), size=3) + 
  labs(title = "Fish Muscle Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Site)
Muscle_Summer_SiteWrap

Muscle_Summer_SpeciesWrap<- FishMuscles_Summer_MeansSE %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=`Age Class`), size=3) + 
  labs(title = "Fish Muscle Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Species)
Muscle_Summer_SpeciesWrap
```

## Fish Liver
```{r}
FishLiverData_040722 <- read_excel("Data/FishLiverData_040722.xlsx")

FishLiver_Summer<-filter(FishLiverData_040722, Season == "Summer")

FishLiver_Summer_FM<-subset(FishLiver_Summer, Site == "FM")
FishLiver_Summer_HL<-subset(FishLiver_Summer, Site == "HL")
FishLiver_Summer_PT<-subset(FishLiver_Summer, Site == "PT")
FishLiver_Summer_SD<-subset(FishLiver_Summer, Site == "SD")

unique(FishLiver_Summer_FM$Species)
unique(FishLiver_Summer_HL$Species)
unique(FishLiver_Summer_PT$Species)
unique(FishLiver_Summer_SD$Species)

FishLiver_SummerSpecies<-filter(FishLiver_Summer, Species %in% c("SB", "SCP", "ST"))

#Okay, now I want to get the average and standard error of C and N values for these fish muscles
FishLiver_SummerSpecies$`D13CVPDB(permill)`<- as.numeric(FishLiver_SummerSpecies$`D13CVPDB(permill)`)

FishLiver_SummerSpecies$`D15NAir(permill)`<- as.numeric(FishLiver_SummerSpecies$`D15NAir(permill)`)

FishLiver_SummerSpecies$`D34SVCDT(permill)`<- as.numeric(FishLiver_SummerSpecies$`D34SVCDT(permill)`)

#Checking for outliers.
unique(FishLiver_SummerSpecies$NComment)
unique(FishLiver_SummerSpecies$C_Comment)
#ST from PT may have been mixed up with a YFG but the values for ST seem within reason.
#The YFG has a really low N value compared to the others. So it may be incorrect. So it is possible they actually did get mixed up.. Just remove them all? 
FishLivers_Summer_MeansSE<-FishLiver_SummerSpecies%>% 
  group_by(Species, Site, Season, `Age Class`) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

FishLivers_Summer_MeansSE$D13C_StdError[is.nan(FishLivers_Summer_MeansSE$D13C_StdError)]<-0

FishLivers_Summer_MeansSE$D13C_StdError[is.na(FishLivers_Summer_MeansSE$D13C_StdError)]<-0

FishLivers_Summer_MeansSE$D13C_SD[is.nan(FishLivers_Summer_MeansSE$D13C_SD)]<-0

FishLivers_Summer_MeansSE$D13C_UCI[is.nan(FishLivers_Summer_MeansSE$D13C_UCI)]<-0

FishLivers_Summer_MeansSE$D13C_LCI[is.nan(FishLivers_Summer_MeansSE$D13C_LCI)]<-0

FishLivers_Summer_MeansSE$D15N_StdError[is.nan(FishLivers_Summer_MeansSE$D15N_StdError)]<-0

FishLivers_Summer_MeansSE$D15N_StdError[is.na(FishLivers_Summer_MeansSE$D15N_StdError)]<-0

FishLivers_Summer_MeansSE$D15N_SD[is.nan(FishLivers_Summer_MeansSE$D15N_SD)]<-0

FishLivers_Summer_MeansSE$D15N_UCI[is.nan(FishLivers_Summer_MeansSE$D15N_UCI)]<-0

FishLivers_Summer_MeansSE$D15N_LCI[is.nan(FishLivers_Summer_MeansSE$D15N_LCI)]<-0

Liver_Summer<- FishLivers_Summer_MeansSE %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  labs(title = "Fish Liver Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))
Liver_Summer

Liver_Summer_SiteWrap<- FishLivers_Summer_MeansSE %>% ggplot(aes(D13C_mean, D15N_mean, color= Species)) + 
  geom_point(aes(color = Species, shape=`Age Class`), size=3) + 
  labs(title = "Fish Liver Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Site)
Liver_Summer_SiteWrap

Liver_Summer_SpeciesWrap<- FishLivers_Summer_MeansSE %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=`Age Class`), size=3) + 
  labs(title = "Fish Liver Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Species)
Liver_Summer_SpeciesWrap
```

## Big Inverts
```{r}
#Went through and manually deleted all the columns for rows which had incorrect readings due to combustion column failure. 

LargeMacroinvert_IsotopeAndMetaData_040822 <- read_excel("Data/LargeMacroinvert_IsotopeAndMetaData_040822_Edited.xlsx")
unique(LargeMacroinvert_IsotopeAndMetaData_040822$Site)
LargeMacroinvert_IsotopeAndMetaData_040822$Site[LargeMacroinvert_IsotopeAndMetaData_040822$Site %in% "SB"]<-"FM"

LargeMacroinvert_IsotopeAndMetaData_040822$`D13CVPDB(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D13CVPDB(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040822$`D15NAir(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D15NAir(permill)`)

LargeMacroinvert_IsotopeAndMetaData_040822$`D34SVCDT(permill)`<- as.numeric(LargeMacroinvert_IsotopeAndMetaData_040822$`D34SVCDT(permill)`)

#Introduce Season column
LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date<-mdy(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date)

str(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date)

LargeMacroinvert_IsotopeAndMetaData_040822$Month<- format(LargeMacroinvert_IsotopeAndMetaData_040822$Collection_Date, format = "%m")
unique(LargeMacroinvert_IsotopeAndMetaData_040822$Month)

LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "06"]<-"Summer"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "07"]<-"Summer"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "08"]<-"Fall"
LargeMacroinvert_IsotopeAndMetaData_040822$Season[LargeMacroinvert_IsotopeAndMetaData_040822$Month %in% "09"]<-"Fall"

BigInvertsSummer<-filter(LargeMacroinvert_IsotopeAndMetaData_040822, Season %in% "Summer")

BigInvertsSummer_FM<-filter(BigInvertsSummer, Site %in% "FM")
BigInvertsSummer_HL<-filter(BigInvertsSummer, Site %in% "HL")
BigInvertsSummer_PT<-filter(BigInvertsSummer, Site %in% "PT")
BigInvertsSummer_SD<-filter(BigInvertsSummer, Site %in% "SD")

unique(BigInvertsSummer_FM$Species)
unique(BigInvertsSummer_HL$Species)
unique(BigInvertsSummer_PT$Species)
unique(BigInvertsSummer_SD$Species)

BigInvertsSummer_Species<- filter(BigInvertsSummer, Species %in% c("Exopalaemon", "Harris mud crab"))

#Already removed all outliers manually in excel (samples which the combustion column failed)

BigInverts_Summer_MeansSd<-BigInvertsSummer_Species%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))


BigInverts_Seasons<- BigInverts_Summer_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  labs(title = "Big Inverts Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) 
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
BigInverts_Seasons
```
## Small Inverts
```{r}
SmallMacroinvert_IsotopeAndMetaData_040422 <- read_excel("Data/SmallMacroinvert_IsotopeAndMetaData_040422.xlsx")

SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D13CVPDB(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D15NAir(permill)`)

SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`<- as.numeric(SmallMacroinvert_IsotopeAndMetaData_040422$`D34SVCDT(permill)`)

SmallInvertsSummer<-subset(SmallMacroinvert_IsotopeAndMetaData_040422, Season == "Summer")
unique(SmallInvertsSummer$Site)

SmallInvertsSummer_FM<- filter(SmallInvertsSummer, Site %in% "FM")
SmallInvertsSummer_HL<- filter(SmallInvertsSummer, Site %in% "HL")
SmallInvertsSummer_PT<- filter(SmallInvertsSummer, Site %in% "PT")
SmallInvertsSummer_SD<- filter(SmallInvertsSummer, Site %in% "SD")

unique(SmallInvertsSummer_FM$Species)
unique(SmallInvertsSummer_HL$Species)
unique(SmallInvertsSummer_PT$Species)
unique(SmallInvertsSummer_SD$Species)

SmallInverts_SpeciesSummer<- SmallMacroinvert_IsotopeAndMetaData_040422 %>% filter(Species %in% "Mysid")

unique(SmallInverts_SpeciesSummer$C_Comment) #No warnings, all data should be okay.
#Just kidding the isopods are weird. Do calculation independently later to see where it went wrong.
#View(SmallInverts_SpeciesBothSeasons)

#Okay, now I want to get the average and sd of C and N values for these inverts.
SmallInverts_Summer_MeansSd<-SmallInverts_SpeciesSummer%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

SmallInverts_Summer_MeansSd$D13C_StdError[is.nan(SmallInverts_Summer_MeansSd$D13C_StdError)]<-0

SmallInverts_Summer_MeansSd$D13C_StdError[is.na(SmallInverts_Summer_MeansSd$D13C_StdError)]<-0

SmallInverts_Summer_MeansSd$D13C_SD[is.nan(SmallInverts_Summer_MeansSd$D13C_SD)]<-0

SmallInverts_Summer_MeansSd$D13C_UCI[is.nan(SmallInverts_Summer_MeansSd$D13C_UCI)]<-0

SmallInverts_Summer_MeansSd$D13C_LCI[is.nan(SmallInverts_Summer_MeansSd$D13C_LCI)]<-0

SmallInverts_Summer_MeansSd$D15N_StdError[is.nan(SmallInverts_Summer_MeansSd$D15N_StdError)]<-0

SmallInverts_Summer_MeansSd$D15N_StdError[is.na(SmallInverts_Summer_MeansSd$D15N_StdError)]<-0

SmallInverts_Summer_MeansSd$D15N_SD[is.nan(SmallInverts_Summer_MeansSd$D15N_SD)]<-0

SmallInverts_Summer_MeansSd$D15N_UCI[is.nan(SmallInverts_Summer_MeansSd$D15N_UCI)]<-0

SmallInverts_Summer_MeansSd$D15N_LCI[is.nan(SmallInverts_Summer_MeansSd$D15N_LCI)]<-0

SmallInverts_Summer<- SmallInverts_Summer_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site), size=3) + 
  labs(title = "Small Invert (Mysid only) Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))
SmallInverts_Summer 
```
## Zoops
```{r}
ZoopIsotopeAndMetaData_040722_edited <- read_excel("Data/ZoopIsotopeAndMetaData_040722_edited.xlsx")
ZoopIsotopeAndMetaData_040722_edited$Species<-ZoopIsotopeAndMetaData_040722_edited$ZoopSpecies
Zoops_Summer<-filter(ZoopIsotopeAndMetaData_040722_edited, Season %in% "Summer")

Zoops_Summer_FM<-filter(Zoops_Summer, Site %in% "FM")
Zoops_Summer_HL<-filter(Zoops_Summer, Site %in% "HL")
Zoops_Summer_PT<-filter(Zoops_Summer, Site %in% "PT")
Zoops_Summer_SD<-filter(Zoops_Summer, Site %in% "SD")
#Now filter out just these  species 

unique(Zoops_Summer_FM$Species)
unique(Zoops_Summer_HL$Species)
unique(Zoops_Summer_PT$Species)
unique(Zoops_Summer_SD$Species)

Zoops_SpeciesSummer<- Zoops_Summer %>% filter(Species %in% c( ">500 um", "A. sinensis", "P. forbesi"))

#Lets look for outliers
unique(Zoops_SpeciesSummer$NComment) #Looks like an okay sample. Gonna leave it.

#Okay, now I want to get the average and sd of C and N values for these fish livers.
View(Zoops_SpeciesBothSeasons)

Zoops_SpeciesSummer$`D13CVPDB(permill)`<- as.numeric(Zoops_SpeciesSummer$`D13CVPDB(permill)`)

Zoops_SpeciesSummer$`D15NAir(permill)`<- as.numeric(Zoops_SpeciesSummer$`D15NAir(permill)`)

Zoops_SpeciesSummer$`D34SVCDT(permill)`<- as.numeric(Zoops_SpeciesSummer$`D34SVCDT(permill)`)

Zoops_Summer_MeansSd<-Zoops_SpeciesSummer%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

Zoops_Summer_MeansSd$D13C_StdError[is.nan(Zoops_Summer_MeansSd$D13C_StdError)]<-0

Zoops_Summer_MeansSd$D13C_StdError[is.na(Zoops_Summer_MeansSd$D13C_StdError)]<-0

Zoops_Summer_MeansSd$D13C_SD[is.nan(Zoops_Summer_MeansSd$D13C_SD)]<-0

Zoops_Summer_MeansSd$D13C_UCI[is.nan(Zoops_Summer_MeansSd$D13C_UCI)]<-0

Zoops_Summer_MeansSd$D13C_LCI[is.nan(Zoops_Summer_MeansSd$D13C_LCI)]<-0

Zoops_Summer_MeansSd$D15N_StdError[is.nan(Zoops_Summer_MeansSd$D15N_StdError)]<-0

Zoops_Summer_MeansSd$D15N_StdError[is.na(Zoops_Summer_MeansSd$D15N_StdError)]<-0

Zoops_Summer_MeansSd$D15N_SD[is.nan(Zoops_Summer_MeansSd$D15N_SD)]<-0

Zoops_Summer_MeansSd$D15N_UCI[is.nan(Zoops_Summer_MeansSd$D15N_UCI)]<-0

Zoops_Summer_MeansSd$D15N_LCI[is.nan(Zoops_Summer_MeansSd$D15N_LCI)]<-0


Zoops_Summer_Plot<- Zoops_Summer_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  labs(title = "Zoop Means And Standard Error from Summer") +
  theme_bw()+
  coord_cartesian(ylim=c(10, 15),  xlim=c(-35, -25))+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) 
Zoops_Summer_Plot

Zoops_Summer_SpeciesWrap<- Zoops_Summer_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site), size=3) + 
  labs(title = "Zoop Means And Standard Error from Summer") +
  theme_bw()+
  coord_cartesian(ylim=c(10, 15),  xlim=c(-35, -25))+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Species)
Zoops_Summer_SpeciesWrap
```
## Plants
```{r}
PlantIsotopeAndMetaData_040822 <- read_excel("Data/PlantIsotopeAndMetaData_040822.xlsx")
Plants_Summer<-filter(PlantIsotopeAndMetaData_040822, Season %in% "Summer")
Plants_Summer_FM<-filter(Plants_Summer, Site %in% "FM")
Plants_Summer_HL<-filter(Plants_Summer, Site %in% "HL")
Plants_Summer_PT<-filter(Plants_Summer, Site %in% "PT")
Plants_Summer_SD<-filter(Plants_Summer, Site %in% "SD")

unique(Plants_Summer_FM$Species)
unique(Plants_Summer_HL$Species)
unique(Plants_Summer_PT$Species)
unique(Plants_Summer_SD$Species)


Plants_SpeciesSummer<- Plants_Summer %>% filter(Species %in% "Schoenoplectus acutusa")

#Okay, now I want to get the average and sd of C and N values for these fish livers.

Plants_SpeciesSummer$`D13CVPDB(permill)`<- as.numeric(Plants_SpeciesSummer$`D13CVPDB(permill)`)

Plants_SpeciesSummer$`D15NAir(permill)`<- as.numeric(Plants_SpeciesSummer$`D15NAir(permill)`)

Plants_SpeciesSummer$`D34SVCDT(permill)`<- as.numeric(Plants_SpeciesSummer$`D34SVCDT(permill)`)

#NEED TO STILL LOOK AT OUTLIERS AND THE EFFECTS OF TAP WATER VS DI!

#Okay, now I want to get the average and sd of C and N values for these inverts.

Plants_Summer_MeansSd<-Plants_SpeciesSummer%>% 
  group_by(Species, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))


unique(Plants_SpeciesSummer$Site)

Plants_Summer_Plot<- Plants_Summer_MeansSd %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site), size=3) + 
  scale_shape_manual(values=rep(0:13, 1))+
  labs(title = "Plant (Schoenoplectus acutusa) Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError)) #+
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
Plants_Summer_Plot 
```
## POM/BA
```{r}
POM_BA_IsotopeAndMetaData_040522 <- read_excel("Data/POM_BA_IsotopeAndMetaData_040522.xlsx")
View(POM_BA_IsotopeAndMetaData_040522)
str(POM_BA_IsotopeAndMetaData_040522$Date)
#Introduce Season column
POM_BA_IsotopeAndMetaData_040522$Month<- format(POM_BA_IsotopeAndMetaData_040522$Date, format = "%m")
unique(POM_BA_IsotopeAndMetaData_040522$Month)

POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "06"]<-"Summer"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "07"]<-"Summer"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "08"]<-"Fall"
POM_BA_IsotopeAndMetaData_040522$Season[POM_BA_IsotopeAndMetaData_040522$Month %in% "09"]<-"Fall"
View(POM_BA_IsotopeAndMetaData_040522)

#Okay, now I want to get the average and sd of C and N values for POM and BA by site and season.

POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D13CVPDB(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D15NAir(permill)`)

POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`<- as.numeric(POM_BA_IsotopeAndMetaData_040522$`D34SVCDT(permill)`)
```

```{r}
#Lets look at how far off the samples with warnings are from the samples without warnings
POM_BA_IsotopeAndMetaData_040522<-POM_BA_IsotopeAndMetaData_040522[!(POM_BA_IsotopeAndMetaData_040522$Site=="NA" | POM_BA_IsotopeAndMetaData_040522$Site=="SD or SM"),]

Carbon_OutlierPlot_POM<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "POM") %>%  ggplot(aes(x = Site, y=`D13CVPDB(permill)`)) + geom_boxplot(aes(color=C_Comment))+theme_bw() + labs(title = "POM Carbon Outlier Check from Summer and Fall")+facet_wrap(~Season)

Carbon_OutlierPlot_POM

Nitrogen_OutlierPlot_POM<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "POM") %>%  ggplot(aes(x = Site, y=`D15NAir(permill)`)) + geom_boxplot(aes(color=NComment))+theme_bw() + labs(title = "POM Nitrogen Outlier Check from Summer and Fall")+facet_wrap(~Season)

Nitrogen_OutlierPlot_POM

Carbon_OutlierPlot_BA<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "Benthic") %>%  ggplot(aes(x = Site, y=`D13CVPDB(permill)`)) + geom_boxplot(aes(color=C_Comment))+theme_bw() + labs(title = "Benthic Alge Carbon Outlier Check from Summer and Fall")+facet_wrap(~Season)

Carbon_OutlierPlot_BA

Nitrogen_OutlierPlot_BA<- POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` == "Benthic") %>%  ggplot(aes(x = Site, y=`D15NAir(permill)`)) + geom_boxplot(aes(color=NComment))+theme_bw() + labs(title = "Benthic Algae Nitrogen Outlier Check from Summer and Fall")+facet_wrap(~Season)

Nitrogen_OutlierPlot_BA
```

Outlier anaylsis results: I plotted boxplots of POM and BA data by site and season to look for N and C outliers and color coded to see which data belonged to flagged rows. 
For POM Carbon, there were outliers BUT they all belonged to rows with no comments from the SIF lab. No action needed.

For POM Nitrogen, there were some outliers belonging to "Precision decreases for samples containing less than 20 mu grams of N." Remove those belonging to that comment group which fell outside the range of the no comment group.
List: CMP-POM-110-CN, CMP-POM-135-CN, CMP-POM-36-CN, CMP-POM-150-CN, CMP-POM-150rep-CN, CMP-POM-151-CN, CMP-POM-93-CN, CMP-POM-94-CN, CMP-POM-156-CN, CMP-POM-146-CN, CMP-POM-159-CN, CMP-POM-170-CN, CMP-POM-171-CN.

For BA Carbon, all of the samples belonging to "Contained more carbon than the largest reference" was an outlier. Also true for the comments "Mass 44 & 45 saturated, totals underestimated" and "Mass 45 saturated; estimated value used." Remove them. 

For BA Nitrogen, any with the comment, "Contained more nitrogen than largest reference" was an outlier. Remove them. 

```{r}
#unique(POM_BA_IsotopeAndMetaData_040522$NComment)
#BA_OutliersRemoved<-POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type`=="Benthic") %>% subset(NComment!="Contained more nitrogen than largest reference")
#unique(BA_OutliersRemoved$C_Comment) #Cool, deleting the problematic N comments also deleted the problematic C comments.

POM_BA_IsotopeAndMetaData_040522 %>% filter(`Sample Type` =="POM") %>% filter(NComment == "NA") %>% filter(Site == "SD", Season== "Summer") %>%  summary(`D15NAir(permill)`)

#I used the min and max of the pom samples for each site and season to determine which rows to remove of POM that were flagged by SIF. These samples have issues with nitrogen values.

POMBA_OutliersRemoved<- POM_BA_IsotopeAndMetaData_040522[!POM_BA_IsotopeAndMetaData_040522$CarolinesLabel %in% c("CMP-POM-110-CN", "CMP-POM-135-CN", "CMP-POM-36-CN", "CMP-POM-150-CN", "CMP-POM-150rep-CN", "CMP-POM-151-CN", "CMP-POM-93-CN", "CMP-POM-94-CN", "CMP-POM-156-CN", "CMP-POM-146-CN", "CMP-POM-159-CN", "CMP-POM-170-CN", "CMP-POM-171-CN", "CMP-BA-51-CN", "CMP-BA-52-CN", "CMP-BA-192-CN"),]

unique(POM_OutliersRemoved$CarolinesLabel)

View(POMBA_OutliersRemoved)  
```

```{r}
#Okay, now I want to get the average and sd of C and N values for these inverts.

POMBA_BothSeasons_MeansSd<-POMBA_OutliersRemoved%>% 
  group_by(`Sample Type`, Site, Season) %>% 
  summarize(n=n(),
            alpha = 0.05,
            D13C_mean = sum(`D13CVPDB(permill)`/n, na.rm=TRUE), 
            D13C_SD = sqrt(sum((`D13CVPDB(permill)`- (D13C_mean))^2)/(n-1)),
            D13C_StdError= standard_error(`D13CVPDB(permill)`),
            D13C_UCI = D13C_mean+qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D13C_LCI= D13C_mean-qt(1-alpha/2, (n-1))*D13C_SD/sqrt(n),
            D15N_mean = sum(`D15NAir(permill)`/n, na.rm=TRUE),
            D15N_SD = sqrt(sum((`D15NAir(permill)`- (D15N_mean))^2)/(n-1)),
            D15N_StdError= standard_error(`D15NAir(permill)`),
            D15N_UCI = D15N_mean+qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n),
            D15N_LCI = D15N_mean-qt(1-alpha/2, (n-1))*D15N_SD/sqrt(n))

POMBA_BothSeasons_MeansSd$D13C_StdError[is.nan(POMBA_BothSeasons_MeansSd$D13C_StdError)]<-0

POMBA_BothSeasons_MeansSd$D13C_StdError[is.na(POMBA_BothSeasons_MeansSd$D13C_StdError)]<-0

POMBA_BothSeasons_MeansSd$D13C_SD[is.nan(POMBA_BothSeasons_MeansSd$D13C_SD)]<-0

POMBA_BothSeasons_MeansSd$D13C_UCI[is.nan(POMBA_BothSeasons_MeansSd$D13C_UCI)]<-0

POMBA_BothSeasons_MeansSd$D13C_LCI[is.nan(POMBA_BothSeasons_MeansSd$D13C_LCI)]<-0

POMBA_BothSeasons_MeansSd$D15N_StdError[is.nan(POMBA_BothSeasons_MeansSd$D15N_StdError)]<-0

POMBA_BothSeasons_MeansSd$D15N_StdError[is.na(POMBA_BothSeasons_MeansSd$D15N_StdError)]<-0

POMBA_BothSeasons_MeansSd$D15N_SD[is.nan(POMBA_BothSeasons_MeansSd$D15N_SD)]<-0

POMBA_BothSeasons_MeansSd$D15N_UCI[is.nan(POMBA_BothSeasons_MeansSd$D15N_UCI)]<-0

POMBA_BothSeasons_MeansSd$D15N_LCI[is.nan(POMBA_BothSeasons_MeansSd$D15N_LCI)]<-0

#Remove Sites NA, 'SD or SM'
unique(POMBA_BothSeasons_MeansSd$Site)
#POMBA_BothSeasons_MeanSd<-POMBA_BothSeasons_MeansSd[!(POMBA_BothSeasons_MeansSd$Site=="NA" | POMBA_BothSeasons_MeansSd$Site=="SD or SM"),]
#unique(POMBA_BothSeasons_MeanSd$Site)
POMBA_Summer<- POMBA_BothSeasons_MeansSd %>% filter(Season %in% "Summer") %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=`Sample Type`), size=3) + 
  labs(title = "POM and BA Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))# +
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
POMBA_Summer 

POMBA_Summ<-POMBA_BothSeasons_MeansSd %>% filter(Season %in% "Summer")
```

## Spatial Differences Summer
```{r}
POMBA_Summ<-rename(POMBA_Summ, Species=`Sample Type`)

SummerSpatial_NoFish<-rbind(BigInverts_Summer_MeansSd, SmallInverts_Summer_MeansSd, Zoops_Summer_MeansSd, Plants_Summer_MeansSd,POMBA_Summ)

SummerSpatial_NoFish$Species<- factor(SummerSpatial_NoFish$Species, levels = c("Exopalaemon", "Harris mud crab", "Mysid", ">500 um", "A. sinensis", "P. forbesi", "Schoenoplectus acutusa", "Benthic", "POM")) #Changing level order 

SummerSpatial_NoFish_Plot1<-SummerSpatial_NoFish %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  scale_shape_manual(values=rep(0:9, 1))+
  labs(title = "No fish Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
SummerSpatial_NoFish_Plot1

SummerSpatial_NoFish_Plot2<-SummerSpatial_NoFish %>% ggplot(aes(D13C_mean, D15N_mean, color= Species)) + 
  geom_point(aes(color = Species), size=3) + 
  labs(title = "No fish Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Site)
SummerSpatial_NoFish_Plot2

SummerSpatial_FishLiver<-rbind(FishLivers_Summer_MeansSE, BigInverts_Summer_MeansSd, SmallInverts_Summer_MeansSd, Zoops_Summer_MeansSd, Plants_Summer_MeansSd,POMBA_Summ)
unique(SummerSpatial_FishLiver$Species)

SummerSpatial_FishLiver$Species<- factor(SummerSpatial_FishLiver$Species, levels = c("SB", "ST", "SCP", "Exopalaemon", "Harris mud crab", "Mysid", ">500 um", "A. sinensis", "P. forbesi", "Schoenoplectus acutusa", "Benthic", "POM")) #Changing level order 

SummerSpatial_FishLiver_Plot1<-SummerSpatial_FishLiver %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  scale_shape_manual(values=rep(0:11, 1))+
  labs(title = "With Fish Liver Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
SummerSpatial_FishLiver_Plot1

SummerSpatial_FishLiver_Plot2<-SummerSpatial_FishLiver %>% ggplot(aes(D13C_mean, D15N_mean, color= Species)) + 
  geom_point(aes(color = Species), size=3) + 
  labs(title = "With Fish Liver Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Site)
SummerSpatial_FishLiver_Plot2

SummerSpatial_FishMuscle<-rbind(FishMuscles_Summer_MeansSE, BigInverts_Summer_MeansSd, SmallInverts_Summer_MeansSd, Zoops_Summer_MeansSd, Plants_Summer_MeansSd,POMBA_Summ)
unique(SummerSpatial_FishMuscle$Species)

SummerSpatial_FishMuscle$Species<- factor(SummerSpatial_FishMuscle$Species, levels = c("SB", "ST", "SCP", "YFG", "Exopalaemon", "Harris mud crab", "Mysid", ">500 um", "A. sinensis", "P. forbesi", "Schoenoplectus acutusa", "Benthic", "POM")) #Changing level order 

SummerSpatial_FishMuscle_Plot1<-SummerSpatial_FishMuscle %>% ggplot(aes(D13C_mean, D15N_mean, color= Site)) + 
  geom_point(aes(color = Site, shape=Species), size=3) + 
  scale_shape_manual(values=rep(0:12, 1))+
  labs(title = "With Fish Muscle Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))
  #facet_wrap(~factor(Season, levels=c("Summer", "Fall")))
SummerSpatial_FishMuscle_Plot1

SummerSpatial_FishMuscle_Plot2<-SummerSpatial_FishMuscle %>% ggplot(aes(D13C_mean, D15N_mean, color= Species)) + 
  geom_point(aes(color = Species), size=3) + 
  labs(title = "With Fish Muscle Means And Standard Error from Summer") +
  theme_bw()+
  geom_errorbar(aes(ymin = D15N_mean-D15N_StdError, ymax = D15N_mean+D15N_StdError))+
  geom_errorbarh(aes(xmin = D13C_mean-D13C_StdError, xmax = D13C_mean+D13C_StdError))+
  facet_wrap(~Site)
SummerSpatial_FishMuscle_Plot2
```